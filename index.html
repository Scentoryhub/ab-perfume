<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Perfume List</title>
    <link rel="icon" type="image/png" href="icon/32.png" />
    <link rel="apple-touch-icon" href="icon/180.png" />

    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-ZKERETN8Y2"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-ZKERETN8Y2", {
        custom_map: { dimension1: "client_id" },
      });
      gtag("get", "G-ZKERETN8Y2", "client_id", (clientID) => {
        localStorage.setItem("ga_client_id", clientID);
        gtag("set", "user_properties", { client_id: clientID });
      });
    </script>

    <script>
      !(function (f, b, e, v, n, t, s) {
        if (f.fbq) return;
        n = f.fbq = function () {
          n.callMethod
            ? n.callMethod.apply(n, arguments)
            : n.queue.push(arguments);
        };
        if (!f._fbq) f._fbq = n;
        n.push = n;
        n.loaded = !0;
        n.version = "2.0";
        n.queue = [];
        t = b.createElement(e);
        t.async = !0;
        t.src = v;
        s = b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t, s);
      })(
        window,
        document,
        "script",
        "https://connect.facebook.net/en_US/fbevents.js"
      );
      fbq("init", "9083739771684521");
      fbq("track", "PageView");
    </script>
    <noscript
      ><img
        height="1"
        width="1"
        style="display: none"
        src="https://www.facebook.com/tr?id=9083739771684521&ev=PageView&noscript=1"
    /></noscript>
    <style>
      /* ================= GLOBAL RESET ================= */
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        padding: 0;
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        background: #fff;
        color: #222;
        -webkit-font-smoothing: antialiased;
        padding-bottom: 80px;
      }
      a {
        color: black;
        font-weight: bold;
        text-decoration: none;
      }

      /* ================= HEADER & SEARCH ================= */
      .price-info {
        max-width: 600px;
        margin: 0 auto 20px auto;
        padding: 20px;
        background-color: #f9f9f9;
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        text-align: center;
      }
      .price-info p {
        margin: 8px 0;
        font-size: 1rem;
        color: #333;
        font-weight: 500;
      }
      .TOP {
        text-align: center;
        margin-top: 20px;
      }
      .info-button {
        background: none;
        border: none;
        color: #333;
        font-weight: 700;
        text-decoration: underline;
        cursor: pointer;
        font-size: 1rem;
        padding: 5px;
      }

      .search-container {
        max-width: 600px;
        margin: 20px auto;
        padding: 0 15px;
        position: relative;
      }
      #search-input {
        width: 100%;
        padding: 12px 40px 12px 20px;
        font-size: 1.1rem;
        border: 1px solid #ccc;
        border-radius: 25px;
        outline: none;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }
      #search-clear-btn {
        position: absolute;
        top: 50%;
        right: 30px;
        transform: translateY(-50%);
        background: #ccc;
        color: white;
        border: none;
        border-radius: 50%;
        width: 22px;
        height: 22px;
        cursor: pointer;
        display: none;
        align-items: center;
        justify-content: center;
      }
      .sort-container {
        max-width: 900px;
        margin: 0 auto 15px auto;
        padding: 0 20px;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .sort-container label {
        margin-right: 10px;
        font-weight: 600;
        color: #555;
      }
      #sort-by {
        padding: 8px 12px;
        font-size: 1rem;
        border: 1px solid #ccc;
        border-radius: 8px;
        background-color: #f9f9f9;
      }

      /* ================= NAVBAR ================= */
      .navbar {
        display: flex;
        justify-content: flex-start;
        overflow-x: auto;
        gap: 10px;
        position: sticky;
        top: 0;
        z-index: 100;
        padding: 12px 15px;
        background: rgba(255, 255, 255, 0.95);
        border-bottom: 1px solid #eee;
        backdrop-filter: blur(10px);
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
      }
      .navbar::-webkit-scrollbar {
        display: none;
      }
      .navbar button {
        flex: 0 0 auto;
        background: #f8f8f8;
        border: 1px solid #e0e0e0;
        padding: 8px 18px;
        cursor: pointer;
        font-size: 0.95rem;
        font-weight: 500;
        border-radius: 25px;
        color: #555;
        transition: all 0.2s ease;
      }
      .navbar button.active {
        background: #222;
        color: #fff;
        border-color: #222;
      }

      /* ================= GALLERY (Top Picks) ================= */
      #top-picks-container {
        display: none;
        max-width: 100%; /* Changed to full width for smoother marquee */
        margin: 0 auto;
        overflow: hidden; /* Hide scrollbar */
      }
      .top-scroll-wrapper {
        display: flex;
        overflow-x: auto;
        gap: 15px;
        padding: 10px 15px;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none; /* Hide scrollbar Firefox */
      }
      .top-scroll-wrapper::-webkit-scrollbar {
        display: none; /* Hide scrollbar Chrome/Safari */
      }
      .top-card {
        flex: 0 0 140px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* Slightly stronger shadow */
        overflow: hidden;
        position: relative;
        /* border: 1px solid #f0f0f0;  Removed border to reduce white space look */
        cursor: pointer;
        padding: 0; /* REMOVED PADDING to make image fill */
      }
      .top-card img {
        width: 100%;
        height: 140px;
        object-fit: cover;
        display: block; /* Removes bottom space */
      }
      .top-card .top-info {
        padding: 8px 5px; /* Add padding only to text area */
        text-align: center;
        background: #fff;
      }
      .top-card .top-name {
        font-size: 0.85rem;
        font-weight: bold;
        margin-bottom: 3px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .top-card .top-price {
        color: #d9534f;
        font-weight: 800;
        font-size: 0.95rem;
      }
      .hot-badge {
        position: absolute;
        top: 0;
        left: 0;
        background: linear-gradient(135deg, #ff6b6b, #ff3b30);
        color: white;
        font-size: 0.7rem;
        padding: 3px 8px;
        border-bottom-right-radius: 8px; /* Style change */
        font-weight: 800;
        z-index: 2;
      }

      /* ================= MAIN GALLERY ================= */
      .gallery {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 10px;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        min-height: 300px;
      }
      .item {
        position: relative;
        overflow: hidden;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        background: #fff;
        transition: transform 0.3s ease;
      }
      .item[data-stock="0"] {
        display: none !important;
      }

      .item img {
        width: 100%;
        height: 250px;
        object-fit: cover;
      }
      .caption {
        padding: 16px;
        font-size: 1rem;
        font-weight: 600;
        text-align: center;
        border-top: 1px solid #eee;
      }
      .product-size {
        font-size: 0.85rem;
        color: #888;
        margin: 4px 0;
        font-weight: normal;
      }
      .item .add-to-cart {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: #fff;
        border: none;
        border-radius: 50%;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 1.2rem;
        z-index: 3;
      }
      .item-cart-count {
        position: absolute;
        top: -5px;
        right: -5px;
        background-color: #f44;
        color: white;
        border-radius: 50%;
        padding: 2px 6px;
        font-size: 0.8rem;
        display: none;
      }
      .add-to-cart-confirmation {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #28a745;
        color: white;
        padding: 6px 12px;
        border-radius: 15px;
        font-size: 0.9rem;
        font-weight: bold;
        opacity: 0;
        transition: all 0.5s ease;
        z-index: 10;
        pointer-events: none;
      }
      .add-to-cart-confirmation.show {
        opacity: 1;
        transform: translate(-50%, -100%);
      }

      /* ================= WHY BUY FROM US ================= */
      .trust-section {
        max-width: 1200px;
        margin: 40px auto;
        padding: 30px 20px;
        background: #fdfdfd;
        border-top: 1px solid #eee;
      }
      .trust-title {
        text-align: center;
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 30px;
        color: #222;
      }
      .trust-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 30px;
      }
      .trust-item {
        text-align: center;
        padding: 20px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        position: relative;
        overflow: hidden;
      }
      .trust-icon {
        font-size: 2.5rem;
        margin-bottom: 15px;
        display: block;
      }

      .whatsapp-card {
        text-decoration: none;
        color: inherit;
        display: block;
        transition: transform 0.2s, box-shadow 0.2s, border 0.2s;
        border: 1px solid transparent;
      }
      .whatsapp-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(37, 211, 102, 0.2);
        border: 1px solid #25d366;
      }

      .review-carousel {
        display: flex;
        overflow-x: auto; /* Allow JS to scroll it */
        gap: 0; /* Remove gap, handle spacing via padding if needed */
        padding: 10px 0;
        scrollbar-width: none;
        -webkit-overflow-scrolling: touch;
        justify-content: flex-start;
      }
      .review-carousel::-webkit-scrollbar {
        display: none;
      }

      .trust-review-img {
        flex: 0 0 100%; /* Use full width of container */
        height: 220px; /* Increased height */
        object-fit: cover; /* Fill the area */
        border-radius: 8px;
        border: none; /* Removed border */
        cursor: zoom-in;
        display: block;
        margin-right: 10px; /* Spacing between items for carousel */
      }

      .trust-text h4 {
        margin: 10px 0;
        font-size: 1.1rem;
      }
      .trust-text p {
        font-size: 0.95rem;
        color: #666;
        line-height: 1.5;
      }

      /* ================= MODALS ================= */
      .modal {
        display: none;
        position: fixed;
        left: 0;
        top: 0;
        width: 100vw;
        height: 100vh;
        align-items: center;
        justify-content: center;
        padding: 15px;
        z-index: 2147483647 !important;
        background-color: rgba(0, 0, 0, 0.85) !important;
      }
      .modal.open {
        display: flex;
      }

      body.modal-open {
        overflow: hidden !important;
      }
      body.modal-open .back-to-top,
      body.modal-open .cart-button {
        display: none !important;
      }

      .modal-content {
        max-width: 600px;
        width: 90vw;
        max-height: 90vh;
        border-radius: 12px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        background: #fff;
        text-align: center;
        position: relative;
      }
      .modal-content img {
        width: 100%;
        max-height: 60vh;
        object-fit: contain;
        background: #f9f9f9;
      }

      @media (max-width: 767px) {
        .modal-content img {
          max-height: 35vh !important;
          margin-bottom: 10px;
        }
        .modal-caption {
          font-size: 1rem !important;
          padding: 5px 15px !important;
        }
      }

      .modal-close {
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 2rem;
        color: #fff;
        cursor: pointer;
        transition: transform 0.3s ease;
        z-index: 10;
        background: rgba(0, 0, 0, 0.3);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        line-height: 38px;
        text-align: center;
      }

      .modal-controls {
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 80px;
      }
      .modal-add-btn {
        background-color: #333;
        color: white;
        border: none;
        padding: 12px 30px;
        font-size: 1.1rem;
        border-radius: 30px;
        cursor: pointer;
        width: 100%;
        max-width: 250px;
      }
      .modal-qty-controls {
        display: none;
        align-items: center;
        gap: 20px;
      }
      .modal-qty-btn {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        font-size: 1.5rem;
        cursor: pointer;
        background: #f0f0f0;
        border: 1px solid #ccc;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .modal-qty-count {
        font-size: 1.5rem;
        font-weight: bold;
        min-width: 30px;
      }

      .cart-button {
        position: fixed;
        bottom: 30px;
        right: 20px;
        background-color: #ffffff;
        color: white;
        border: none;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        cursor: pointer;
      }
      .cart-button.added {
        animation: cart-pulse 0.6s ease-out;
      }
      @keyframes cart-pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.15);
        }
        100% {
          transform: scale(1);
        }
      }
      .cart-count {
        position: absolute;
        top: -5px;
        right: -5px;
        background-color: #f44;
        color: white;
        border-radius: 50%;
        padding: 2px 6px;
        font-size: 0.8rem;
      }
      .cart-icon {
        width: 32px;
        height: 32px;
      }

      .back-to-top {
        display: none;
        position: fixed;
        bottom: 30px;
        left: 30px;
        background-color: #333;
        color: white;
        border: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        text-align: center;
        line-height: 50px;
        cursor: pointer;
        font-size: 1.5rem;
        z-index: 1000;
      }

      .lightbox {
        display: none;
        position: fixed;
        z-index: 2147483647;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        justify-content: center;
        align-items: center;
      }
      .lightbox.open {
        display: flex;
      }
      .lightbox-img {
        width: auto;
        height: auto;
        max-width: 100vw;
        max-height: 85vh;
        object-fit: contain;
      }

      /* Responsive */
      @media (min-width: 768px) {
        .gallery {
          grid-template-columns: repeat(4, 1fr);
          gap: 40px;
          padding: 0 20px;
        }
        /* Top scroll wrapper for desktop */
        .top-scroll-wrapper {
          /* Keep flex to allow JS scrolling logic to work same as mobile */
          display: flex;
          gap: 20px;
          padding: 20px;
          overflow-x: auto;
        }
        .top-card {
          flex: 0 0 180px; /* Fixed width for desktop carousel */
        }
        .top-card img {
          height: 180px; /* Squareish */
        }
        .trust-grid {
          grid-template-columns: repeat(3, 1fr);
        }
      }
    </style>
  </head>
  <body>
    <h2 class="TOP">Perfume List</h2>

    <div class="price-info">
      <div>
        <p style="font-size: 1.1rem; font-weight: 700">Perfumes: From $30</p>
        <p style="font-size: 1.1rem; font-weight: 600">
          Free Shipping | Buy more save more !
        </p>
        <p style="font-size: 1.1rem; font-weight: 700">USA WAREHOUSE</p>
        <p style="font-size: 0.9rem; color: #555">
          (Exact price is shown on each product)
        </p>
      </div>
      <hr class="info-divider" />
      <div style="margin-top: 15px">
        <button id="policy-btn" class="info-button" style="color: #f44">
          Compensation Policy
        </button>
      </div>
    </div>

    <div class="search-container">
      <input
        type="search"
        id="search-input"
        placeholder="Search by name, brand or number..."
      />
      <button id="search-clear-btn" title="Clear search">&times;</button>
    </div>

    <div class="sort-container">
      <label for="sort-by">Sort By:</label>
      <select id="sort-by">
        <option value="default">Default (A-Z)</option>
        <option value="newest">Newest First</option>
        <option value="price-asc">Price: Low to High</option>
        <option value="price-desc">Price: High to Low</option>
      </select>
    </div>

    <div class="navbar" id="brand-navbar">
      <button data-brand="All" class="active">All Brands</button>
      <button data-brand="Giorgio Armani">Armani</button>
      <button data-brand="Azzaro">Azzaro</button>
      <button data-brand="Burberry">Burberry</button>
      <button data-brand="BVLGARI">BVLGARI</button>
      <button data-brand="Carolina Herrera">Carolina Herrera</button>
      <button data-brand="Chanel">Chanel</button>
      <button data-brand="Creed">Creed</button>
      <button data-brand="Dior">Dior</button>
      <button data-brand="Givenchy">Givenchy</button>
      <button data-brand="Gucci">Gucci</button>
      <button data-brand="Initio">Initio</button>
      <button data-brand="Jean Paul Gaultier">Jean Paul Gaultier</button>
      <button data-brand="Kayali">Kayali</button>
      <button data-brand="Kilian">Kilian</button>
      <button data-brand="Lanc√¥me">Lanc√¥me</button>
      <button data-brand="Lattafa">Lattafa</button>
      <button data-brand="Louis Vuitton">Louis Vuitton</button>
      <button data-brand="Maison Francis Kurkdjian">
        Maison Francis Kurkdjian
      </button>
      <button data-brand="Paco Rabanne">Paco Rabanne</button>
      <button data-brand="Parfums de Marly">Parfums de Marly</button>
      <button data-brand="Prada">Prada</button>
      <button data-brand="Ralph Lauren">Ralph Lauren</button>
      <button data-brand="Tom Ford">Tom Ford</button>
      <button data-brand="Valentino">Valentino</button>
      <button data-brand="Versace">Versace</button>
      <button data-brand="Xerjoff">Xerjoff</button>
      <button data-brand="Yves Saint Laurent">Yves Saint Laurent</button>
      <button data-brand="Other">Other Brands</button>
    </div>

    <div id="top-picks-container">
      <h3 style="padding: 0 15px; margin-bottom: 10px; font-size: 1.1rem">
        üî• Best Sellers
      </h3>
      <div class="top-scroll-wrapper" id="top-gallery"></div>
      <hr style="margin: 20px 15px; border: 0; border-top: 1px solid #eee" />
    </div>

    <div class="gallery" id="gallery">
      <div class="gallery-loader"></div>
    </div>

    <div class="trust-section">
      <h2 class="trust-title">Why Buy From Us?</h2>
      <div class="trust-grid">
        <div class="trust-item">
          <span class="trust-icon">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
          <div class="trust-text">
            <h4>Happy Customers</h4>
            <p>Swipe to see real reviews from our customers!</p>
          </div>
          <div class="review-carousel" id="review-carousel">
            <img
              src="images/review1.jpg"
              alt="Review 1"
              class="trust-review-img lightbox-trigger"
              onerror="this.style.display='none'"
            />
            <img
              src="images/review2.jpg"
              alt="Review 2"
              class="trust-review-img lightbox-trigger"
              onerror="this.style.display='none'"
            />
            <img
              src="images/review3.jpg"
              alt="Review 3"
              class="trust-review-img lightbox-trigger"
              onerror="this.style.display='none'"
            />
            <img
              src="images/review4.jpg"
              alt="Review 4"
              class="trust-review-img lightbox-trigger"
              onerror="this.style.display='none'"
            />
            <img
              src="images/review5.jpg"
              alt="Review 5"
              class="trust-review-img lightbox-trigger"
              onerror="this.style.display='none'"
            />
          </div>
        </div>
        <div class="trust-item">
          <span class="trust-icon">üõ°Ô∏è</span>
          <div class="trust-text">
            <h4>Broken? We Reship!</h4>
            <p>
              Don't worry about shipping damage. If it arrives broken or leaked,
              show us a photo and we will reship for <strong>FREE</strong>.
            </p>
            <button
              onclick="document.getElementById('policy-modal').classList.add('open'); document.body.classList.add('modal-open');"
              style="
                margin-top: 10px;
                background: none;
                border: none;
                text-decoration: underline;
                cursor: pointer;
                color: #007bff;
              "
            >
              See Policy
            </button>
          </div>
        </div>
        <a
          href="https://wa.me/16232027321"
          target="_blank"
          class="trust-item whatsapp-card"
        >
          <span class="trust-icon">üí¨</span>
          <div class="trust-text">
            <h4>24/7 WhatsApp Support</h4>
            <p>
              We are always online. Get instant quotes, track your order, and
              get expert recommendations anytime.
            </p>
            <span
              style="
                display: inline-block;
                margin-top: 10px;
                color: #25d366;
                font-weight: bold;
                text-decoration: underline;
              "
              >Click to Chat &rarr;</span
            >
          </div>
        </a>
      </div>
    </div>

    <div class="modal" id="modal">
      <div class="modal-close" id="modal-close">&times;</div>
      <div class="modal-content">
        <img src="" alt="" id="modal-img" />
        <div class="modal-caption" id="modal-caption"></div>
        <div class="modal-controls">
          <button class="modal-add-btn">Add to Cart</button>
          <div class="modal-qty-controls">
            <button class="modal-qty-btn" data-action="decrease">-</button>
            <span class="modal-qty-count">1</span>
            <button class="modal-qty-btn" data-action="increase">+</button>
          </div>
        </div>
      </div>
    </div>

    <div class="lightbox" id="lightbox">
      <img src="" class="lightbox-img" id="lightbox-img" />
    </div>

    <div class="modal" id="policy-modal">
      <div class="modal-close" id="policy-modal-close">&times;</div>
      <div
        class="modal-content"
        style="max-width: 500px; text-align: left; padding: 25px"
      >
        <h3 style="text-align: center; margin-top: 0; font-size: 1.4rem">
          Compensation Policy
        </h3>
        <p>
          Please check your items upon delivery. If you have any issues, follow
          these steps for a free reshipment:
        </p>
        <ul style="padding-left: 20px">
          <li>
            <strong>1. Leaked or Damaged:</strong> Provide photos of: Outer
            Packaging + Shipping Label + Damaged Goods.
          </li>
          <li>
            <strong>2. Wrong Product Sent:</strong> Provide photos of: Shipping
            Label + Incorrect Goods.
          </li>
        </ul>
        <p
          style="
            font-weight: bold;
            text-align: center;
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 8px;
          "
        >
          Important: Please keep all shipping packaging until you've checked
          everything.
        </p>
      </div>
    </div>

    <div class="modal" id="receipt-modal">
      <div class="modal-close" id="receipt-modal-close">&times;</div>
      <div
        class="modal-content"
        style="max-width: 600px; padding: 0; overflow: hidden"
      >
        <img
          src="images/receipt.webp"
          alt="Receipt Example"
          style="max-height: 85vh"
        />
        <div style="padding: 12px; font-weight: bold">Example Receipt</div>
      </div>
    </div>

    <button id="back-to-top" class="back-to-top">&#x25B2;</button>

    <button class="cart-button" id="cart-button">
      <img src="icon/order.png" alt="Cart" class="cart-icon" />
      <span id="cart-count" class="cart-count">0</span>
    </button>

    <script src="db.js"></script>
    <script>
      // =================================================================
      // CORE LOGIC & TRACKING
      // =================================================================

      let cartItems = [];
      let gallery,
        searchInput,
        searchClearBtn,
        cartButton,
        cartCount,
        brandNavbar;

      function loadCartFromLocalStorage() {
        const storedCart = localStorage.getItem("perfumeCart");
        cartItems = storedCart ? JSON.parse(storedCart) : [];
      }
      function saveCartToLocalStorage() {
        localStorage.setItem("perfumeCart", JSON.stringify(cartItems));
      }
      function updateCartCount() {
        const count = cartItems.reduce(
          (total, item) => total + item.quantity,
          0
        );
        if (cartCount) cartCount.textContent = count;
      }
      function renderItemCounts() {
        if (!gallery) return;
        const currentItems = gallery.querySelectorAll(".item");
        currentItems.forEach((item) => {
          const itemName = item.dataset.name;
          const badge = item.querySelector(".item-cart-count");
          const itemInCart = cartItems.find((c) => c.name === itemName);
          if (itemInCart && itemInCart.quantity > 0) {
            badge.textContent = itemInCart.quantity;
            badge.style.display = "block";
          } else {
            badge.style.display = "none";
          }
        });
      }
      function pulseCartButton() {
        cartButton.classList.add("added");
        setTimeout(() => cartButton.classList.remove("added"), 600);
      }
      function showConfirmation(button) {
        const confirmation = document.createElement("div");
        confirmation.textContent = "Added!";
        confirmation.className = "add-to-cart-confirmation";
        const itemElement = button.closest(".item");
        itemElement.appendChild(confirmation);
        setTimeout(() => confirmation.classList.add("show"), 10);
        setTimeout(() => confirmation.remove(), 1500);
      }

      // --- ADD TO CART FUNCTION ---
      function addItemToCart(productId) {
        const db = window.perfumeDB || [];
        const perfumeData = db.find((p) => p.id === productId);
        if (!perfumeData) return;

        const existingItem = cartItems.find((c) => c.name === productId);
        if (existingItem) {
          existingItem.quantity++;
        } else {
          cartItems.push({
            name: productId,
            caption: `${productId} - ${perfumeData.name}`,
            img: perfumeData.img,
            quantity: 1,
            price: Number(perfumeData.price),
            tier: perfumeData.tier,
            ml: perfumeData.ml,
            floz: perfumeData.floz,
            brand: perfumeData.brand,
          });
        }
        saveCartToLocalStorage();
        updateCartCount();
        renderItemCounts();
        pulseCartButton();

        if (typeof fbq !== "undefined") {
          fbq("track", "AddToCart", {
            content_ids: [productId],
            content_type: "product",
            value: perfumeData.price,
            currency: "USD",
          });
        }
        if (typeof gtag !== "undefined") {
          gtag("event", "add_to_cart", {
            currency: "USD",
            value: perfumeData.price,
            items: [{ item_id: productId, item_name: perfumeData.name }],
          });
        }
      }

      // --- AUTO SCROLL LOGIC FOR CAROUSELS ---
      function startInfiniteScroll(containerId, speed = 1) {
        const container = document.getElementById(containerId);
        if (!container || container.children.length === 0) return;

        // Clone children to create infinite illusion
        const originalContent = Array.from(container.children);
        originalContent.forEach((child) => {
          const clone = child.cloneNode(true);
          // Ensure clone keeps event listeners by re-binding if needed,
          // but for basic click/display, simple clone is fine.
          // For best sellers click:
          if (child.onclick) clone.onclick = child.onclick;
          container.appendChild(clone);
        });

        let scrollPos = 0;
        let isPaused = false;

        function step() {
          if (!isPaused) {
            scrollPos += speed;
            // If we scrolled past the first set of items, reset to 0
            // (container.scrollWidth / 2 is approximate check point)
            if (scrollPos >= container.scrollWidth / 2) {
              scrollPos = 0;
            }
            container.scrollLeft = scrollPos;
          }
          requestAnimationFrame(step);
        }

        // Pause on interaction
        container.addEventListener("mouseenter", () => (isPaused = true));
        container.addEventListener("mouseleave", () => (isPaused = false));
        container.addEventListener("touchstart", () => (isPaused = true));
        container.addEventListener("touchend", () => (isPaused = false));

        requestAnimationFrame(step);
      }

      // --- MAIN RENDER LOGIC ---
      window.renderPerfumes = function () {
        const db = window.perfumeDB || [];
        if (!gallery) return;

        const topContainer = document.getElementById("top-picks-container");
        const topGallery = document.getElementById("top-gallery");
        const topItems = db.filter((p) => p.top == 1);
        if (topContainer && topGallery && topItems.length > 0) {
          topGallery.innerHTML = "";
          topItems.forEach((p) => {
            const el = document.createElement("div");
            el.className = "top-card";
            el.onclick = () => {
              const mainItem = document.querySelector(
                `.item[data-name="${p.id}"]`
              );
              if (mainItem) mainItem.click();
            };
            // Modified HTML for No Padding Image
            el.innerHTML = `
                   <div class="hot-badge">HOT</div>
                   <img src="${p.img}" loading="lazy">
                   <div class="top-info"><div class="top-name">${p.name}</div><div class="top-price">$${p.price}</div></div>`;
            topGallery.appendChild(el);
          });
          // Start Carousel for Best Sellers
          startInfiniteScroll("top-gallery", 0.8);
        }
        window.applyLastState();
      };

      window.filterAndSearch = function () {
        const db = window.perfumeDB || [];
        if (db.length === 0) return;
        const activeBrandBtn = brandNavbar.querySelector("button.active");
        const selectedBrand = activeBrandBtn
          ? activeBrandBtn.dataset.brand
          : "All";
        const selectedSort = document.getElementById("sort-by").value;
        const term = searchInput.value.toLowerCase().trim();

        const topContainer = document.getElementById("top-picks-container");
        if (topContainer) {
          const hasTop = db.some((p) => p.top == 1);
          topContainer.style.display =
            selectedBrand === "All" && !term && hasTop ? "block" : "none";
        }

        let filtered = db.filter((p) => {
          let brandMatch =
            selectedBrand === "All"
              ? true
              : selectedBrand === "Other"
              ? ![
                  "Dior",
                  "Chanel",
                  "Gucci",
                  "Tom Ford",
                  "Versace",
                  "YSL",
                  "Creed",
                  "Armani",
                  "Prada",
                  "Valentino",
                ].includes(p.brand)
              : p.brand === selectedBrand;
          if (selectedBrand === "Other") {
            const majors = [
              "Dior",
              "Chanel",
              "Gucci",
              "Tom Ford",
              "Versace",
              "YSL",
              "Creed",
              "Armani",
              "Prada",
              "Valentino",
            ];
            brandMatch = !majors.some((b) => p.brand.includes(b));
          }
          let searchMatch = true;
          if (term)
            searchMatch =
              p.name.toLowerCase().includes(term) ||
              p.id.toLowerCase().includes(term) ||
              p.brand.toLowerCase().includes(term);
          return brandMatch && searchMatch;
        });

        if (selectedSort === "price-asc")
          filtered.sort((a, b) => a.price - b.price);
        else if (selectedSort === "price-desc")
          filtered.sort((a, b) => b.price - a.price);
        else if (selectedSort === "newest") filtered.reverse();
        else
          filtered.sort((a, b) =>
            a.id.localeCompare(b.id, undefined, {
              numeric: true,
              sensitivity: "base",
            })
          );

        gallery.innerHTML = "";
        if (filtered.length === 0) {
          gallery.innerHTML =
            '<div class="no-results-message">No items found.</div>';
          return;
        }
        filtered.forEach((p) => {
          const item = document.createElement("div");
          item.className = "item";
          item.dataset.name = p.id;
          item.dataset.img = p.img;
          item.dataset.stock = p.stock;

          item.innerHTML = `
                <img src="${p.img}" loading="lazy">
                <div class="caption">
                  ${p.id} - ${p.name}
                  <br>
                  <span class="product-size">
                    ${p.ml ? p.ml + "ml" : ""} ${
            p.floz ? "/ " + p.floz + " FL.OZ" : ""
          }
                  </span>
                  <br>
                  <strong>$${p.price}</strong>
                </div>
                <button class="add-to-cart">üõí <span class="item-cart-count"></span></button>`;
          gallery.appendChild(item);
        });
        renderItemCounts();

        localStorage.setItem("lastFilterBrand", selectedBrand);
        localStorage.setItem("lastSearchTerm", term);
        localStorage.setItem("lastSort", selectedSort);
      };

      window.applyLastState = function () {
        const lastBrand = localStorage.getItem("lastFilterBrand") || "All";
        const lastSearch = localStorage.getItem("lastSearchTerm") || "";
        const lastSort = localStorage.getItem("lastSort") || "default";

        document.getElementById("sort-by").value = lastSort;
        searchInput.value = lastSearch;

        const btns = document.querySelectorAll(".navbar button");
        btns.forEach((b) => {
          if (b.dataset.brand === lastBrand) b.classList.add("active");
          else b.classList.remove("active");
        });

        if (lastSearch)
          document.getElementById("search-clear-btn").style.display = "flex";
        window.filterAndSearch();
      };

      function updateModalUI(productId) {
        const modalAddBtn = document.querySelector(".modal-add-btn");
        const modalQtyControls = document.querySelector(".modal-qty-controls");
        const modalQtyCount = document.querySelector(".modal-qty-count");

        const itemInCart = cartItems.find((c) => c.name === productId);

        if (itemInCart && itemInCart.quantity > 0) {
          modalAddBtn.style.display = "none";
          modalQtyControls.style.display = "flex";
          modalQtyCount.textContent = itemInCart.quantity;
        } else {
          modalAddBtn.style.display = "block";
          modalQtyControls.style.display = "none";
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        gallery = document.getElementById("gallery");
        searchInput = document.getElementById("search-input");
        searchClearBtn = document.getElementById("search-clear-btn");
        cartButton = document.getElementById("cart-button");
        cartCount = document.getElementById("cart-count");
        brandNavbar = document.getElementById("brand-navbar");

        brandNavbar.addEventListener("click", (e) => {
          if (e.target.tagName === "BUTTON") {
            brandNavbar
              .querySelectorAll("button")
              .forEach((b) => b.classList.remove("active"));
            e.target.classList.add("active");
            searchInput.value = "";
            searchClearBtn.style.display = "none";
            window.filterAndSearch();
          }
        });

        searchInput.addEventListener("input", () => {
          searchClearBtn.style.display = searchInput.value ? "flex" : "none";
          window.filterAndSearch();
        });
        searchClearBtn.addEventListener("click", () => {
          searchInput.value = "";
          searchInput.dispatchEvent(new Event("input"));
        });
        document
          .getElementById("sort-by")
          .addEventListener("change", window.filterAndSearch);

        cartButton.addEventListener(
          "click",
          () => (window.location.href = "cart.html")
        );

        let currentModalProductId = null;

        gallery.addEventListener("click", (e) => {
          const addBtn = e.target.closest(".add-to-cart");
          if (addBtn) {
            e.stopPropagation();
            const item = addBtn.closest(".item");
            addItemToCart(item.dataset.name);
            showConfirmation(addBtn);
          } else {
            const item = e.target.closest(".item");
            if (item) {
              currentModalProductId = item.dataset.name;
              const modal = document.getElementById("modal");
              const img = document.getElementById("modal-img");
              const cap = document.getElementById("modal-caption");
              const addBtnModal = document.querySelector(".modal-add-btn");

              img.src = item.dataset.img;
              cap.innerHTML = item.querySelector(".caption").innerHTML;

              updateModalUI(currentModalProductId);

              addBtnModal.onclick = () => {
                addItemToCart(currentModalProductId);
                updateModalUI(currentModalProductId);
              };

              modal.classList.add("open");
              document.body.classList.add("modal-open");
            }
          }
        });

        document
          .querySelector(".modal-controls")
          .addEventListener("click", (e) => {
            const btn = e.target.closest(".modal-qty-btn");
            if (!btn || !currentModalProductId) return;

            const action = btn.dataset.action;
            const itemIndex = cartItems.findIndex(
              (c) => c.name === currentModalProductId
            );

            if (itemIndex > -1) {
              if (action === "increase") {
                cartItems[itemIndex].quantity++;
              } else if (action === "decrease") {
                cartItems[itemIndex].quantity--;
                if (cartItems[itemIndex].quantity <= 0) {
                  cartItems.splice(itemIndex, 1);
                }
              }
              saveCartToLocalStorage();
              updateCartCount();
              renderItemCounts();
              updateModalUI(currentModalProductId);
            }
          });

        const closeModal = () => {
          document.getElementById("modal").classList.remove("open");
          document.body.classList.remove("modal-open");
          document.getElementById("policy-modal").classList.remove("open");
          document.getElementById("receipt-modal").classList.remove("open");
        };

        document.getElementById("modal-close").onclick = closeModal;
        document.getElementById("policy-modal-close").onclick = closeModal;
        document.getElementById("receipt-modal-close").onclick = closeModal;

        window.onclick = (e) => {
          if (e.target.classList.contains("modal")) closeModal();
        };

        const lightbox = document.getElementById("lightbox");
        const lightboxImg = document.getElementById("lightbox-img");

        document.body.addEventListener("click", (e) => {
          if (e.target.classList.contains("lightbox-trigger")) {
            lightboxImg.src = e.target.src;
            lightbox.classList.add("open");
          }
        });
        lightbox.onclick = () => lightbox.classList.remove("open");

        const backToTop = document.getElementById("back-to-top");
        window.addEventListener("scroll", () => {
          backToTop.style.display = window.pageYOffset > 300 ? "block" : "none";
        });
        backToTop.onclick = () =>
          window.scrollTo({ top: 0, behavior: "smooth" });

        loadCartFromLocalStorage();
        updateCartCount();
        window.renderPerfumes();

        // Start Carousel for Happy Customers (Reviews)
        startInfiniteScroll("review-carousel", 0.6);
      });
    </script>
  </body>
</html>
