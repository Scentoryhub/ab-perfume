<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <title>Top Outlet Perfume</title>
    <link rel="icon" type="image/png" href="icon/32.png" />
    <link rel="apple-touch-icon" href="icon/180.png" />

    <style>
      /* ================= 1. Global Config & Layout ================= */
      :root {
        --header-height: 60px;
        --total-top-spacing: 60px;

        --sidebar-width: 300px;
        --accent-color: #b28900;
        --bg-color: #f8f9fa; /* Slightly cooler grey for premium feel */
        --font-main: "Helvetica Neue", Helvetica, Arial, sans-serif;

        /* Tag Colors */
        --tag-hot: #d9534f;
        --tag-new: #007bff;
        --tag-sale: #28a745;
      }

      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      body {
        margin: 0;
        padding: 0;
        padding-top: var(--total-top-spacing);
        /* Critical: Increase bottom padding to account for floating bar + margin */
        padding-bottom: 100px;
        font-family: var(--font-main);
        background: var(--bg-color);
        color: #333;
        -webkit-font-smoothing: antialiased;
        overflow-x: hidden;
      }

      a {
        text-decoration: none;
        color: inherit;
        cursor: pointer;
      }
      button {
        outline: none;
        font-family: inherit;
        border: none;
        background: none;
        padding: 0;
      }

      /* ================= 2. Header ================= */
      .site-header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: var(--header-height);
        background-color: #000;
        color: #fff;
        display: flex;
        align-items: center;
        padding: 0 15px;
        z-index: 1000;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
      }
      .header-left {
        display: flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        flex-shrink: 0;
      }
      .hamburger-icon {
        font-size: 1.5rem;
        line-height: 1;
      }
      .menu-text {
        font-size: 0.85rem;
        font-weight: 700;
        letter-spacing: 1px;
        display: none;
      }
      @media (min-width: 360px) {
        .menu-text {
          display: inline;
        }
      }

      .header-center {
        flex-grow: 1;
        display: flex;
        justify-content: flex-end;
        padding: 0 10px;
      }
      .header-search-input {
        width: 100%;
        background: #222;
        border: 1px solid #333;
        color: #fff;
        padding: 8px 15px;
        border-radius: 20px; /* More rounded search */
        font-size: 0.9rem;
        outline: none;
        transition: all 0.3s;
      }
      .header-search-input:focus {
        background: #fff;
        color: #000;
        border-color: #fff;
      }

      .header-right {
        position: relative;
        cursor: pointer;
        display: flex;
        align-items: center;
        flex-shrink: 0;
        padding-left: 5px;
      }
      .header-cart-badge {
        position: absolute;
        top: -6px;
        right: -6px;
        background-color: #d9534f;
        color: white;
        font-size: 0.7rem;
        min-width: 18px;
        height: 18px;
        border-radius: 9px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        border: 2px solid #000;
        padding: 0 3px;
      }

      /* ================= 3. Sidebar ================= */
      .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        z-index: 2000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s;
        backdrop-filter: blur(2px);
      }
      .sidebar-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        width: 85%;
        max-width: var(--sidebar-width);
        background: #fff;
        z-index: 2001;
        transform: translateX(-100%);
        transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1);
        display: flex;
        flex-direction: column;
        box-shadow: 5px 0 25px rgba(0, 0, 0, 0.15);
      }
      .sidebar.active {
        transform: translateX(0);
      }

      .sidebar-header {
        display: flex;
        border-bottom: 1px solid #eee;
      }
      .sidebar-tab {
        flex: 1;
        text-align: center;
        padding: 18px 0;
        font-weight: 800;
        font-size: 0.95rem;
        color: #333;
        background: #fff;
        letter-spacing: 1px;
      }
      .sidebar-content {
        flex: 1;
        overflow-y: auto;
        padding: 25px;
        -webkit-overflow-scrolling: touch;
      }
      .menu-link {
        display: block;
        padding: 16px 0;
        font-size: 1.05rem;
        font-weight: 600;
        color: #333;
        border-bottom: 1px solid #f5f5f5;
        text-transform: capitalize;
      }
      .brand-list {
        display: flex;
        flex-direction: column;
        gap: 0;
      }
      .brand-item {
        padding: 14px 5px;
        font-size: 0.95rem;
        color: #555;
        cursor: pointer;
        border-bottom: 1px solid #f9f9f9;
        transition: padding 0.2s;
      }
      .brand-item:hover {
        color: #000;
        padding-left: 8px;
        font-weight: bold;
      }

      /* ================= Wholesale Banner (Greedy Bar) ================= */
      .ws-banner {
        background: #111;
        color: #fff;
        padding: 12px 10px;
        text-align: center;
        transition: background 0.3s;
        position: sticky;
        top: var(--header-height);
        z-index: 990;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }

      .ws-banner.active-tier {
        background: linear-gradient(135deg, #000 0%, #333 100%);
        border-bottom: 2px solid #ffd700;
      }

      .ws-progress-box {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 6px;
        padding: 8px 12px;
        margin: 0 auto;
        max-width: 96%;
        display: inline-block;
        backdrop-filter: blur(5px);
      }
      .ws-progress-text {
        font-size: 0.9rem;
        margin-bottom: 3px;
        color: #fff;
        font-weight: 500;
      }
      .ws-highlight {
        color: #ffd700;
        font-weight: 800;
        font-size: 1.05rem;
      }

      .ws-pills {
        display: flex;
        justify-content: center;
        gap: 8px;
        flex-wrap: wrap;
      }
      .ws-pill {
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid #444;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 500;
      }
      .ws-pill span {
        color: #ffd700;
        font-weight: 800;
        margin-left: 2px;
      }

      /* ================= NEW Floating Capsule Bottom Bar ================= */
      .bottom-nav-bar {
        position: fixed;
        bottom: 25px; /* Floating! */
        left: 50%;
        transform: translateX(-50%); /* Perfectly Centered */
        width: 92%; /* Not full width */
        max-width: 500px;
        height: 72px;
        background: #ffffff;
        z-index: 3000;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 10px 0 20px; /* Balanced padding */
        border-radius: 50px; /* Capsule Shape */
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12); /* Beautiful, diffused shadow */
        border: 1px solid rgba(0, 0, 0, 0.02);
      }

      /* Left Side: Asset Area */
      .nav-left {
        flex: 1;
        display: flex;
        align-items: center;
        cursor: pointer;
        gap: 12px; /* Space between icon and text */
      }

      .nav-icon-wrap {
        position: relative;
        display: flex;
        align-items: center;
      }

      .nav-cart-icon {
        width: 28px;
        height: 28px;
        stroke: #1a1a1a;
        fill: none;
        stroke-width: 1.8;
      }

      .nav-badge {
        position: absolute;
        top: -6px;
        right: -8px;
        background-color: #ff3b30; /* High-vis Red */
        color: #fff;
        font-size: 0.7rem;
        font-weight: 800;
        min-width: 18px;
        height: 18px;
        border-radius: 9px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid #fff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .nav-info-col {
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .price-row {
        display: flex;
        align-items: baseline;
        gap: 6px;
        line-height: 1;
        margin-bottom: 4px;
      }

      /* Main Price */
      .nav-price {
        font-size: 1.3rem;
        font-weight: 800;
        color: #000;
        letter-spacing: -0.5px;
      }

      /* Strikethrough Price */
      .nav-original-price {
        font-size: 0.85rem;
        color: #999;
        text-decoration: line-through;
        font-weight: 500;
      }

      /* Subtext */
      .nav-subtext {
        font-size: 0.75rem;
        color: #28a745; /* Trust Green */
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 4px;
        line-height: 1;
      }

      /* Right Side: Action Button */
      .nav-right {
        flex: 0 0 auto;
      }

      .checkout-pill-btn {
        background-color: #25d366; /* Vibrant Green */
        color: #fff;
        border: none;
        border-radius: 30px; /* Full Rounded inside capsule */
        padding: 14px 28px;
        font-size: 1rem;
        font-weight: 800;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 15px rgba(37, 211, 102, 0.35); /* Glowing shadow */
        cursor: pointer;
        transition: transform 0.1s;
        text-transform: uppercase;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .checkout-pill-btn:active {
        transform: scale(0.95);
      }

      /* ================= BUTTON STYLES (Cards) ================= */
      /* Large Black "ADD TO CART" Button */
      .action-btn-black {
        background: #000;
        color: #fff;
        padding: 12px 0;
        width: 100%;
        font-size: 0.9rem;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 800;
        display: block;
        border: none;
        text-transform: uppercase;
        transition: background 0.2s;
      }
      .action-btn-black:active {
        background: #333;
      }

      /* Rectangular Qty Control Box */
      .action-qty-box {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: #fff;
        border: 2px solid #000;
        border-radius: 8px;
        height: 44px;
        overflow: hidden;
        width: 100%;
      }
      .qty-btn-rect {
        width: 50px;
        height: 100%;
        font-size: 1.5rem;
        font-weight: 400;
        background: #000;
        color: #fff;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 1;
        transition: background 0.1s;
      }
      .qty-btn-rect:active {
        background: #333;
      }
      .qty-val-rect {
        flex: 1;
        font-size: 1.1rem;
        font-weight: 800;
        color: #000;
        text-align: center;
      }

      .btn-qty-wrapper {
        width: 100%;
        margin-top: 10px;
        min-height: 44px;
      }

      /* ================= Skeleton & Lazy Load ================= */
      @keyframes skeleton-loading {
        0% {
          background-position: 200% 0;
        }
        100% {
          background-position: -200% 0;
        }
      }
      .skeleton-loader {
        background: #f0f0f0;
        background-image: linear-gradient(
          90deg,
          #f0f0f0 25%,
          #e0e0e0 50%,
          #f0f0f0 75%
        );
        background-size: 200% 100%;
        animation: skeleton-loading 1.5s infinite;
      }
      img.lazy-img {
        opacity: 0;
        transition: opacity 0.4s ease-in;
      }
      img.lazy-img.loaded {
        opacity: 1;
      }

      /* ================= Home View ================= */
      #home-view {
        padding-bottom: 20px;
        display: block;
      }
      .brand-section {
        margin-bottom: 20px;
        background: #fff;
        padding: 20px 0 25px 0;
        border-top: 1px solid #eee;
        border-bottom: 1px solid #eee;
        scroll-margin-top: 170px;
        position: relative;
      }
      .brand-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 15px 12px 15px;
      }
      .brand-title {
        font-size: 1.2rem;
        font-weight: 800;
        color: #111;
        margin: 0;
        text-transform: uppercase;
        letter-spacing: -0.5px;
      }
      .brand-see-all {
        font-size: 0.85rem;
        color: #666;
        text-decoration: underline;
        cursor: pointer;
        padding: 5px;
      }

      .scroll-container-wrapper {
        position: relative;
        padding: 0 8px;
      }
      .scroll-wrapper {
        display: flex;
        overflow-x: auto;
        gap: 15px;
        padding: 5px 10px 20px 10px;
        scrollbar-width: none;
        -webkit-overflow-scrolling: touch;
        scroll-snap-type: x mandatory;
        scroll-behavior: smooth;
      }
      .scroll-wrapper::-webkit-scrollbar {
        display: none;
      }

      .scroll-arrow-btn {
        position: absolute;
        top: 38%;
        transform: translateY(-50%);
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.95);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        z-index: 10;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        opacity: 0;
        pointer-events: none;
        transition:
          opacity 0.3s,
          transform 0.2s;
        font-size: 1.1rem;
        color: #333;
        border: 1px solid #f0f0f0;
      }
      .scroll-arrow-btn.visible {
        opacity: 1;
        pointer-events: auto;
      }
      .scroll-arrow-btn.left {
        left: 5px;
      }
      .scroll-arrow-btn.right {
        right: 5px;
      }

      .scroll-progress-container {
        width: 60px;
        height: 4px;
        background: #eee;
        border-radius: 2px;
        margin: 0 auto;
        margin-top: -8px;
        overflow: hidden;
      }
      .scroll-progress-bar {
        height: 100%;
        width: 0;
        background: var(--accent-color);
        border-radius: 2px;
        transition: width 0.1s linear;
      }

      .scroll-card {
        flex: 0 0 170px;
        display: flex;
        flex-direction: column;
        background: #fff;
        cursor: pointer;
        position: relative;
        scroll-snap-align: start;
      }
      .img-wrapper {
        width: 100%;
        height: 170px;
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 10px;
        position: relative;
        background: #f9f9f9;
      }
      .img-wrapper img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        transition: transform 0.5s;
      }

      .badges-container {
        position: absolute;
        top: 6px;
        left: 6px;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        z-index: 2;
        gap: 4px;
      }
      .badge-tag {
        font-size: 0.65rem;
        font-weight: 700;
        color: #fff;
        padding: 4px 8px;
        border-radius: 4px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      .badge-hot {
        background: var(--tag-hot);
      }
      .badge-new {
        background: var(--tag-new);
      }
      .badge-sale {
        background: var(--tag-sale);
      }

      .scroll-card-title {
        font-size: 0.9rem;
        color: #222;
        margin-bottom: 4px;
        height: 2.4em;
        overflow: hidden;
        text-transform: uppercase;
        line-height: 1.25;
        font-weight: 600;
      }
      .scroll-card-price {
        font-size: 1.1rem;
        color: var(--accent-color);
        font-weight: 800;
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        margin-bottom: 2px;
      }
      .stock-warning-text {
        font-size: 0.7rem;
        color: #d9534f;
        font-weight: bold;
        margin-left: 5px;
        background: #ffe6e6;
        padding: 2px 6px;
        border-radius: 4px;
        white-space: nowrap;
      }

      .shop-all-section {
        padding: 40px 20px;
        text-align: center;
        background: #fff;
        margin-bottom: 20px;
        border-top: 1px solid #eee;
        border-bottom: 1px solid #eee;
      }
      .shop-all-btn {
        background: #000;
        color: #fff;
        padding: 16px 45px;
        font-size: 1.1rem;
        font-weight: 800;
        border-radius: 30px;
        cursor: pointer;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        transition: transform 0.2s;
        letter-spacing: 1px;
      }

      /* ================= Grid View ================= */
      #grid-view {
        display: none;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px 12px;
      }
      .gallery-header-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
      }
      .gallery-title {
        font-size: 1.4rem;
        font-weight: 800;
      }
      .back-home-btn {
        font-size: 0.95rem;
        text-decoration: underline;
        cursor: pointer;
        color: #666;
        padding: 5px;
      }
      .gallery {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }
      @media (min-width: 768px) {
        .gallery {
          grid-template-columns: repeat(4, 1fr);
          gap: 30px;
        }
      }
      .item {
        background: #fff;
        border-radius: 10px;
        border: 1px solid #eee;
        overflow: hidden;
        transition: box-shadow 0.2s;
      }
      .item:hover {
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
      }
      .item-img-box {
        height: 200px;
        width: 100%;
        position: relative;
        overflow: hidden;
        background: #f9f9f9;
      }
      .item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        cursor: pointer;
      }
      .item .caption {
        padding: 12px 10px;
        text-align: left;
      }
      .item-price {
        font-weight: 800;
        color: var(--accent-color);
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 5px;
      }
      .pagination-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 8px;
        margin: 40px 0;
        flex-wrap: wrap;
      }
      .page-btn {
        padding: 10px 16px;
        background-color: #222;
        color: #fff;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.95rem;
        min-width: 40px;
        text-align: center;
        transition: all 0.2s;
        border: 1px solid transparent;
        font-weight: 600;
      }
      .page-btn:hover {
        background-color: #444;
      }
      .page-btn.active {
        background-color: var(--accent-color);
        color: #000;
        font-weight: 800;
        border: 1px solid #997a00;
      }

      /* ================= Trust Section & Modal ================= */
      .trust-section {
        background: #fff;
        margin-top: 30px;
        padding: 40px 20px;
        border-top: 1px solid #eee;
      }
      .trust-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 25px;
        text-align: center;
      }
      @media (min-width: 768px) {
        .trust-grid {
          grid-template-columns: repeat(2, 1fr);
          max-width: 800px;
          margin: 0 auto;
        }
      }
      .trust-item {
        padding: 25px;
        border: 1px solid #f0f0f0;
        border-radius: 12px;
        display: block;
        background: #fcfcfc;
        transition: transform 0.2s;
      }
      .trust-item:active {
        transform: scale(0.98);
      }
      .trust-item h4 {
        margin: 12px 0 6px;
        font-size: 1.15rem;
        font-weight: 700;
      }
      .trust-item p {
        font-size: 0.95rem;
        color: #666;
        margin: 0;
        line-height: 1.5;
      }

      .modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.85);
        z-index: 2000;
        align-items: center;
        justify-content: center;
        padding: 20px;
        backdrop-filter: blur(5px);
      }
      .modal.open {
        display: flex;
        animation: fadeIn 0.2s ease-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      .modal-content {
        background: #fff;
        width: 100%;
        max-width: 420px;
        border-radius: 16px;
        overflow: hidden;
        position: relative;
        text-align: center;
        padding-bottom: 20px;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        transform: scale(0.95);
        animation: scaleUp 0.2s ease-out forwards;
      }
      @keyframes scaleUp {
        to {
          transform: scale(1);
        }
      }
      .modal-close {
        position: absolute;
        top: 15px;
        right: 15px;
        font-size: 1.8rem;
        cursor: pointer;
        z-index: 10;
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 50%;
        line-height: 40px;
        transition: background 0.2s;
      }
      .modal-close:hover {
        background: #fff;
      }
      .modal-img {
        width: 100%;
        height: 350px;
        object-fit: cover;
        background: #f8f8f8;
      }
      .modal-info {
        padding: 15px 20px;
      }
      .modal-notes-box {
        background-color: #f7f7f7;
        border-radius: 8px;
        padding: 10px 15px;
        margin-bottom: 10px;
        text-align: left;
        border: 1px solid #eee;
      }
      .modal-notes-title {
        font-size: 0.75rem;
        font-weight: 700;
        color: #999;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 4px;
        display: block;
      }
      .modal-notes-text {
        font-size: 0.9rem;
        color: #444;
        line-height: 1.4;
        font-family: Georgia, serif;
        font-style: italic;
      }
      .gender-tag {
        display: inline-block;
        font-size: 0.75rem;
        padding: 2px 8px;
        border-radius: 6px;
        margin-left: 5px;
        vertical-align: middle;
        font-weight: 700;
        letter-spacing: 0.5px;
      }
      .gender-tag.women {
        color: #c2185b;
        background: #fce4ec;
        border: 1px solid #f8bbd0;
      }
      .gender-tag.men {
        color: #1565c0;
        background: #e3f2fd;
        border: 1px solid #bbdefb;
      }
      .gender-tag.unisex {
        color: #455a64;
        background: #eceff1;
        border: 1px solid #cfd8dc;
      }

      #toast {
        visibility: hidden;
        min-width: 220px;
        background-color: rgba(0, 0, 0, 0.9);
        color: #fff;
        text-align: center;
        border-radius: 50px;
        padding: 14px 24px;
        position: fixed;
        z-index: 9999;
        left: 50%;
        bottom: 120px;
        transform: translateX(-50%);
        font-size: 1rem;
        font-weight: 600;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        opacity: 0;
        transition: all 0.3s;
      }
      #toast.show {
        visibility: visible;
        opacity: 1;
        bottom: 130px;
      }
    </style>
  </head>
  <body>
    <header class="site-header">
      <div class="header-left" id="menu-trigger">
        <span class="hamburger-icon">‚ò∞</span>
        <span class="menu-text" style="margin-left: 5px">MENU</span>
      </div>
      <div class="header-center">
        <input
          type="text"
          id="global-search-input"
          class="header-search-input"
          placeholder="Search..."
        />
      </div>
      <div class="header-right" onclick="window.location.href = 'cart.html'">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="white"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <circle cx="9" cy="21" r="1"></circle>
          <circle cx="20" cy="21" r="1"></circle>
          <path
            d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"
          ></path>
        </svg>
        <span id="header-cart-count" class="header-cart-badge">0</span>
      </div>
    </header>

    <div class="sidebar-overlay" id="sidebar-overlay"></div>
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-tab active">MENU</div>
      </div>
      <div class="sidebar-content">
        <nav>
          <a class="menu-link" onclick="handleMenuClick('Home')">Home</a>
          <a class="menu-link" onclick="handleMenuClick('All')">Shop All</a>
          <a
            class="menu-link"
            onclick="handleMenuClick('Gender:Women')"
            style="color: #c2185b"
            >For Her üë©</a
          >
          <a
            class="menu-link"
            onclick="handleMenuClick('Gender:Men')"
            style="color: #1565c0"
            >For Him üë®</a
          >
          <a
            class="menu-link"
            onclick="handleMenuClick('Gender:Unisex')"
            style="color: #455a64"
            >Unisex ‚ö§</a
          >
          <a
            class="menu-link"
            onclick="scrollToBrand('Set')"
            style="color: #6a1b9a"
            >Gift Sets üéÅ</a
          >
          <a class="menu-link" onclick="handleMenuClick('BestSellers')"
            >Best Sellers üî•</a
          >
          <a class="menu-link" onclick="handleMenuClick('New')"
            >New Arrivals üÜï</a
          >
          <a class="menu-link" href="cart.html">My Cart</a>
          <a class="menu-link" href="https://wa.me/16232027321" target="_blank"
            >Contact Us</a
          >
        </nav>
        <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee" />
        <div
          style="
            font-weight: 700;
            margin-bottom: 15px;
            font-size: 0.85rem;
            color: #999;
            letter-spacing: 1px;
          "
        >
          POPULAR BRANDS
        </div>
        <div class="brand-list" id="brand-list-container"></div>
        <div style="height: 50px"></div>
      </div>
    </div>

    <div id="home-view">
      <div id="wholesale-banner" class="ws-banner">
        <div id="ws-content" class="ws-pills"></div>
      </div>

      <div id="home-content">
        <div class="loading-container">
          <div class="spinner"></div>
          <div class="loading-text">LOADING...</div>
        </div>
      </div>
    </div>

    <div id="grid-view">
      <div class="gallery-header-bar">
        <div class="gallery-title" id="grid-title">Results</div>
        <div class="back-home-btn" onclick="handleMenuClick('Home')">
          Back to Home
        </div>
      </div>
      <div class="gallery" id="gallery"></div>
      <div id="pagination-controls" class="pagination-container"></div>
    </div>

    <div class="trust-section">
      <div class="trust-grid">
        <div class="trust-item">
          <div style="font-size: 2rem; margin-bottom: 10px">üá∫üá∏</div>
          <h4>USA Warehouse</h4>
          <p>Fast delivery within 3-5 days.</p>
        </div>
        <div class="trust-item">
          <div style="font-size: 2rem; margin-bottom: 10px">üöö</div>
          <h4>Free Shipping</h4>
          <p>On all orders. No hidden fees.</p>
        </div>
        <div class="trust-item">
          <div style="font-size: 2rem; color: #3498db; margin-bottom: 10px">
            üõ°Ô∏è
          </div>
          <h4>Broken? We Reship!</h4>
          <p>Full replacement if damaged in transit.</p>
          <button
            onclick="
              document.getElementById('policy-modal').classList.add('open')
            "
            style="
              text-decoration: underline;
              cursor: pointer;
              color: blue;
              margin-top: 10px;
              font-size: 0.9rem;
            "
          >
            See Policy
          </button>
        </div>
        <a href="https://wa.me/16232027321" target="_blank" class="trust-item">
          <div style="font-size: 2rem; color: #2ecc71; margin-bottom: 10px">
            üí¨
          </div>
          <h4>WhatsApp Support</h4>
          <p>24/7 instant quote & service.</p>
          <span
            style="
              color: blue;
              text-decoration: underline;
              margin-top: 10px;
              display: block;
              font-size: 0.9rem;
            "
            >Chat Now</span
          >
        </a>
      </div>
    </div>

    <div class="bottom-nav-bar">
      <div class="nav-left" onclick="window.location.href = 'cart.html'">
        <div class="nav-icon-wrap">
          <svg
            class="nav-cart-icon"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="9" cy="21" r="1"></circle>
            <circle cx="20" cy="21" r="1"></circle>
            <path
              d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"
            ></path>
          </svg>
          <div id="bottom-bar-badge" class="nav-badge" style="display: none">
            0
          </div>
        </div>

        <div class="nav-info-col">
          <div class="price-row">
            <span id="bottom-bar-price" class="nav-price">$0</span>
            <span
              id="bottom-bar-original"
              class="nav-original-price"
              style="display: none"
            ></span>
          </div>
          <div class="nav-subtext">
            <span style="font-size: 1rem; line-height: 0">‚úàÔ∏è</span> Free
            Shipping
          </div>
        </div>
      </div>

      <div class="nav-right">
        <button class="checkout-pill-btn" onclick="checkoutViaWhatsapp()">
          CHECKOUT
        </button>
      </div>
    </div>

    <div id="toast">Added to Cart! üõí</div>

    <div id="modal" class="modal">
      <div class="modal-content">
        <div
          class="modal-close"
          onclick="document.getElementById('modal').classList.remove('open')"
        >
          &times;
        </div>
        <img id="modal-img" class="modal-img" src="" />
        <div class="modal-info">
          <h3
            id="modal-title"
            style="margin: 5px 0 2px 0; font-size: 1.1rem; line-height: 1.2"
          ></h3>
          <div
            id="modal-sub"
            style="color: #666; font-size: 0.85rem; margin-bottom: 8px"
          ></div>
          <div id="modal-stock" style="margin-bottom: 8px"></div>
          <div
            id="modal-price"
            style="
              font-weight: bold;
              color: var(--accent-color);
              font-size: 1.3rem;
              margin-bottom: 8px;
            "
          ></div>
          <div id="modal-action-area"></div>
        </div>
      </div>
    </div>

    <div class="modal" id="policy-modal">
      <div
        class="modal-content"
        style="padding: 25px; text-align: left; max-width: 90%"
      >
        <div
          class="modal-close"
          onclick="
            document.getElementById('policy-modal').classList.remove('open')
          "
        >
          &times;
        </div>
        <h3 style="text-align: center; margin-top: 0">Reshipment Policy</h3>
        <p>If items arrive broken or leaked:</p>
        <ul style="padding-left: 20px; color: #555">
          <li style="margin-bottom: 10px">
            Take a photo of the <strong>Shipping Label</strong>.
          </li>
          <li>Take a photo of the <strong>Damaged Item</strong>.</li>
        </ul>
        <p style="text-align: center; font-weight: bold; margin-top: 20px">
          Send to WhatsApp for free reshipment.
        </p>
      </div>
    </div>

    <script src="db.js"></script>
    <script>
      // ================= Configuration =================
      const FEATURED_BRANDS = [
        "Creed",
        "Dior",
        "Chanel",
        "Tom Ford",
        "Yves Saint Laurent",
        "Louis Vuitton",
        "Gucci",
        "Carolina Herrera",
        "Valentino",
        "Maison Francis Kurkdjian",
        "Parfums de Marly",
        "Jean Paul Gaultier",
        "Xerjoff",
        "Bond No. 9",
        "Initio",
        "Paco Rabanne",
        "Giorgio Armani",
        "Burberry",
        "Versace",
      ];
      const FEATURED_BRANDS_LOWER = FEATURED_BRANDS.map((b) => b.toLowerCase());
      const discountTiers = [
        { min: 1, max: 1, percent: 0 },
        { min: 2, max: 2, percent: 0.03 },
        { min: 3, max: 4, percent: 0.05 },
        { min: 5, max: 9, percent: 0.08 },
        { min: 10, max: 19, percent: 0.14 },
        { min: 20, max: 29, percent: 0.24 },
        { min: 30, max: 49, percent: 0.26 },
        { min: 50, max: 79, percent: 0.29 },
        { min: 80, max: 100, percent: 0.32 },
        { min: 101, max: Infinity, percent: 0.35 },
      ];

      // ================= State Variables =================
      let cartItems = [];
      let currentPage = 1;
      const itemsPerPage = 20;
      let currentGridData = [];
      let viewMode = "home";
      let currentModalProductId = null;

      document.addEventListener("DOMContentLoaded", () => {
        loadCart();
        setupMenu();
        renderSidebarBrands();
        setupModalBackdropClosing();
        setupSearch();

        const checkDataInterval = setInterval(() => {
          if (window.perfumeDB && window.perfumeDB.length > 0) {
            clearInterval(checkDataInterval);
            renderHome();
          }
        }, 50);
      });

      window.addEventListener("pageshow", function (event) {
        loadCart();
        if (viewMode === "home") renderHome();
        else renderGridPage();
      });

      function getCartTotalQty() {
        return cartItems.reduce((s, i) => s + i.quantity, 0);
      }

      function getStockHtml(inventory) {
        if (inventory && !isNaN(inventory) && inventory > 0 && inventory < 50) {
          return `<span class="stock-warning-text">Only ${inventory} left!</span>`;
        }
        return "";
      }

      function updateWholesaleBanner() {
        const qty = getCartTotalQty();
        const banner = document.getElementById("wholesale-banner");
        const content = document.getElementById("ws-content");

        // 1. Update Top Banner
        if (banner && content) {
          if (qty === 0) {
            banner.className = "ws-banner";
            content.innerHTML = `<div class="ws-pill">5+ <span>-8%</span></div><div class="ws-pill">10+ <span>-14%</span></div><div class="ws-pill">20+ <span>-24%</span></div><div class="ws-pill">100+ <span>-35%</span></div>`;
          } else {
            let currentTier =
              discountTiers.find((t) => qty >= t.min && qty <= t.max) ||
              discountTiers[0];
            let nextTierIndex = discountTiers.indexOf(currentTier) + 1;
            let nextTier =
              nextTierIndex < discountTiers.length
                ? discountTiers[nextTierIndex]
                : null;

            let html = `<div class="ws-progress-box">`;
            let currentOff = Math.round(currentTier.percent * 100);
            let shippingText = currentOff > 0 ? " ‚Ä¢ ‚úàÔ∏è Free Shipping" : "";

            html += `<div class="ws-progress-text">Cart: <strong>${qty}</strong> items ‚Ä¢ Current: <span class="ws-highlight">-${currentOff}% OFF</span>${shippingText}</div>`;
            if (nextTier) {
              let needMore = nextTier.min - qty;
              let nextOff = Math.round(nextTier.percent * 100);
              html += `<div style="font-size:0.75rem; color:#ccc;">üî• Add <strong>${needMore}</strong> more to get <span style="color:#fff;font-weight:bold">-${nextOff}% OFF</span>!</div>`;
            } else {
              html += `<div style="font-size:0.75rem; color:#ffd700;">üëë Maximum Discount Unlocked!</div>`;
            }
            html += `</div>`;
            content.innerHTML = html;
            banner.classList.add("active-tier");
          }
        }

        // 2. Update Bottom Bar Data
        updateBottomBarData(qty);
      }

      function updateBottomBarData(totalQty) {
        // Update Badge
        const badgeEl = document.getElementById("bottom-bar-badge");
        if (totalQty > 0) {
          badgeEl.textContent = totalQty;
          badgeEl.style.display = "flex";
        } else {
          badgeEl.style.display = "none";
        }

        // Calculate Total Price with Discount
        let subtotal = 0;
        cartItems.forEach((item) => {
          subtotal += item.price * item.quantity;
        });

        const tier = discountTiers.find(
          (t) => totalQty >= t.min && totalQty <= t.max,
        );
        const discountPercent = tier ? tier.percent : 0;
        const finalTotal = subtotal - subtotal * discountPercent;

        // Update Price Text & Strikethrough
        const priceEl = document.getElementById("bottom-bar-price");
        const originalEl = document.getElementById("bottom-bar-original");

        if (totalQty === 0) {
          priceEl.textContent = "$0";
          priceEl.style.color = "#999";
          originalEl.style.display = "none";
        } else {
          priceEl.textContent = "$" + Math.round(finalTotal);
          priceEl.style.color = "#000"; // Big Black Price

          // Show Strikethrough if discount > 0
          if (discountPercent > 0) {
            originalEl.textContent = "~~$" + subtotal.toFixed(0) + "~~";
            originalEl.style.display = "inline-block";
          } else {
            originalEl.style.display = "none";
          }
        }
      }

      function formatSize(item) {
        if (!item.ml) return "";
        if (isNaN(Number(item.ml))) return item.ml;
        const ml = parseInt(item.ml);
        const flOz = (ml / 29.57).toFixed(1);
        return `${ml}ml <span style="color:#999;font-weight:normal">(${flOz} oz)</span>`;
      }

      function getGenderClass(genderText) {
        if (!genderText) return "unisex";
        const g = genderText.toLowerCase();
        if (g.includes("women") || g.includes("female")) return "women";
        if (g.includes("men") || g.includes("male")) return "men";
        return "unisex";
      }

      function renderSidebarBrands() {
        const list = document.getElementById("brand-list-container");
        list.innerHTML = "";
        FEATURED_BRANDS.forEach((brand) => {
          const div = document.createElement("div");
          div.className = "brand-item";
          div.textContent =
            brand === "Yves Saint Laurent" ? "YSL" : brand.toUpperCase();
          div.onclick = () => scrollToBrand(brand);
          list.appendChild(div);
        });
        const otherDiv = document.createElement("div");
        otherDiv.className = "brand-item";
        otherDiv.style.cssText =
          "font-weight: bold; margin-top: 10px; color: var(--accent-color); border-bottom: none;";
        otherDiv.textContent = "OTHER BRANDS";
        otherDiv.onclick = () => scrollToBrand("Other");
        list.appendChild(otherDiv);
      }

      function generatePictureHTML(src, alt) {
        const webpSrc = src.replace(/\.(jpg|png|jpeg)$/i, ".webp");
        return `<div class="img-wrapper skeleton-loader"><picture><source srcset="${webpSrc}" type="image/webp"><img src="${src}" alt="${alt}" loading="lazy" class="lazy-img" onload="this.classList.add('loaded'); this.parentElement.parentElement.classList.remove('skeleton-loader');" onerror="this.parentElement.parentElement.classList.remove('skeleton-loader');"></picture></div>`;
      }

      // --- 4. Logic for "Modal Style" Add-to-Cart Buttons on Cards ---
      // This is the updated function you requested to move outside
      function getCartQty(id) {
        const item = cartItems.find((c) => c.name === id);
        return item ? item.quantity : 0;
      }

      // Updated: Returns Large Black Button or Rectangular Control Box
      function getAddButtonHtml(id) {
        const qty = getCartQty(id);
        if (qty === 0) {
          // State 0: Large Black Button
          return `<button class="action-btn-black" onclick="updateItemQty('${id}', 1); event.stopPropagation();">ADD TO CART</button>`;
        } else {
          // State >0: Rectangular Control Box
          return `
                <div class="action-qty-box">
                    <div class="qty-btn-rect" onclick="updateItemQty('${id}', -1); event.stopPropagation();">-</div>
                    <div class="qty-val-rect">${qty}</div>
                    <div class="qty-btn-rect" onclick="updateItemQty('${id}', 1); event.stopPropagation();">+</div>
                </div>`;
        }
      }

      // --- Home Render Logic ---
      function renderHome() {
        const db = (window.perfumeDB || []).filter(
          (p) => parseInt(p.stock) > 0,
        );
        const container = document.getElementById("home-content");
        if (!container) return;
        container.innerHTML = "";

        const renderSection = (title, items, filterKey) => {
          const section = createBrandSection(title, items, filterKey);
          if (
            filterKey &&
            !["BestSellers", "New", "Sale"].includes(filterKey)
          ) {
            section.id = "brand-" + filterKey.replace(/\s+/g, "");
          }
          container.appendChild(section);
        };

        const bestSellers = db.filter((p) => p.top == 1);
        if (bestSellers.length > 0)
          renderSection("üî• Best Sellers", bestSellers, "BestSellers");

        const newArrivals = db.filter((p) => p.new == 1);
        if (newArrivals.length > 0)
          renderSection("üÜï New Arrivals", newArrivals, "New");

        const renderedBrands = new Set();
        FEATURED_BRANDS.forEach((brand) => {
          const products = db.filter((p) =>
            p.brand.toLowerCase().includes(brand.toLowerCase()),
          );
          if (products.length >= 3) {
            let displayName =
              brand === "Yves Saint Laurent" ? "YSL" : brand.toUpperCase();
            renderSection(displayName, products, brand);
            renderedBrands.add(brand);
          }
        });

        const otherProducts = db.filter((p) => {
          for (let featured of renderedBrands) {
            if (p.brand.toLowerCase().includes(featured.toLowerCase()))
              return false;
          }
          return true;
        });

        if (otherProducts.length > 0) {
          const otherSection = createBrandSection(
            "Other Brands",
            otherProducts,
            "Other",
          );
          otherSection.id = "brand-Other";
          container.appendChild(otherSection);
        }

        const saleItems = db.filter((p) => p.sale == 1);
        if (saleItems.length > 0)
          renderSection("üè∑Ô∏è On Sale", saleItems, "Sale");

        const setItems = db.filter((p) => p.name.toUpperCase().includes("SET"));
        if (setItems.length > 0) renderSection("üéÅ Gift Sets", setItems, "Set");

        const shopAllContainer = document.createElement("div");
        shopAllContainer.className = "shop-all-section";
        shopAllContainer.innerHTML = `<button class="shop-all-btn" onclick="handleMenuClick('All')">Shop All Products</button>`;
        container.appendChild(shopAllContainer);
      }

      function createBrandSection(title, products, filterKey) {
        const section = document.createElement("div");
        section.className = "brand-section";
        const cleanFilterKey =
          filterKey || (title.includes("Best") ? "BestSellers" : "All");

        const header = document.createElement("div");
        header.className = "brand-header";
        header.innerHTML = `<h2 class="brand-title">${title}</h2><div class="brand-see-all" onclick="switchToGrid('${cleanFilterKey}')">See All ></div>`;
        section.appendChild(header);

        const wrapperContainer = document.createElement("div");
        wrapperContainer.className = "scroll-container-wrapper";
        const leftBtn = document.createElement("div");
        leftBtn.className = "scroll-arrow-btn left";
        leftBtn.innerHTML = "&#10094;";
        const rightBtn = document.createElement("div");
        rightBtn.className = "scroll-arrow-btn right";
        rightBtn.innerHTML = "&#10095;";
        const wrapper = document.createElement("div");
        wrapper.className = "scroll-wrapper";

        products.slice(0, 15).forEach((p) => {
          const card = document.createElement("div");
          card.className = "scroll-card";
          card.onclick = (e) => {
            if (
              e.target.closest(".action-btn-black") ||
              e.target.closest(".action-qty-box")
            )
              return;
            openModal(p);
          };

          let badgesHtml = "";
          if (p.top == 1)
            badgesHtml += '<div class="badge-tag badge-hot">HOT</div>';
          if (p.new == 1)
            badgesHtml += '<div class="badge-tag badge-new">NEW</div>';
          if (p.sale == 1)
            badgesHtml += '<div class="badge-tag badge-sale">SALE</div>';

          const imgHtml = generatePictureHTML(p.img, p.name);
          const genderClass = getGenderClass(p.gender);
          const genderHtml = p.gender
            ? `<span class="gender-tag ${genderClass}">${p.gender}</span>`
            : "";
          const stockHtml = getStockHtml(p.inventory);

          // Use NEW button logic
          const buttonHtml = getAddButtonHtml(p.id);

          card.innerHTML = `
            <div style="position:relative;">${imgHtml}<div class="badges-container">${badgesHtml}</div></div>
            <div style="padding: 0 5px 5px 5px; display:flex; flex-direction:column; flex:1;">
                <div class="scroll-card-title">${p.id}-${p.name}</div>
                <div style="display:flex; align-items:center; margin-bottom:4px; flex-wrap:wrap;">
                    <span style="font-size:0.75rem; color:#666; font-weight:600;">${p.brand}</span>
                    ${genderHtml}
                </div>
                <div class="scroll-card-price">
                    $${p.price} ${stockHtml}
                    <span style="font-size:0.75rem; color:#666; font-weight:normal; margin-left:5px;">${p.ml ? formatSize(p) : ""}</span>
                </div>
                <div class="btn-qty-wrapper" id="btn-wrap-${p.id}">${buttonHtml}</div>
            </div>
          `;
          wrapper.appendChild(card);
        });

        const progressContainer = document.createElement("div");
        progressContainer.className = "scroll-progress-container";
        const progressBar = document.createElement("div");
        progressBar.className = "scroll-progress-bar";
        progressContainer.appendChild(progressBar);

        wrapperContainer.appendChild(leftBtn);
        wrapperContainer.appendChild(wrapper);
        wrapperContainer.appendChild(rightBtn);
        section.appendChild(wrapperContainer);
        section.appendChild(progressContainer);

        const updateControls = () => {
          const maxScroll = wrapper.scrollWidth - wrapper.clientWidth;
          const scrollLeft = wrapper.scrollLeft;
          leftBtn.classList.toggle("visible", scrollLeft > 10);
          rightBtn.classList.toggle("visible", scrollLeft < maxScroll - 10);
          if (maxScroll > 0) {
            const percentage = (scrollLeft / maxScroll) * 100;
            progressBar.style.width = Math.max(10, percentage) + "%";
          } else {
            progressBar.style.width = "100%";
          }
        };

        leftBtn.onclick = () =>
          wrapper.scrollBy({ left: -200, behavior: "smooth" });
        rightBtn.onclick = () =>
          wrapper.scrollBy({ left: 200, behavior: "smooth" });
        wrapper.addEventListener("scroll", updateControls);
        setTimeout(updateControls, 100);

        return section;
      }

      // --- Brand & Search Logic ---
      const BRAND_ALIASES = {
        lv: "Louis Vuitton",
        "louis vuitton": "Louis Vuitton",
        louis: "Louis Vuitton",
        ysl: "Yves Saint Laurent",
        yves: "Yves Saint Laurent",
        saint: "Yves Saint Laurent",
        tf: "Tom Ford",
        tom: "Tom Ford",
        ford: "Tom Ford",
        creed: "Creed",
        dior: "Dior",
        chanel: "Chanel",
        gucci: "Gucci",
        pdm: "Parfums de Marly",
        marly: "Parfums de Marly",
        mfk: "Maison Francis Kurkdjian",
        kurkdjian: "Maison Francis Kurkdjian",
        valentino: "Valentino",
        versace: "Versace",
        armani: "Giorgio Armani",
        "giorgio armani": "Giorgio Armani",
        burberry: "Burberry",
        lattafa: "Lattafa",
        kayali: "Kayali",
        bond: "Bond No. 9",
        "bond no 9": "Bond No. 9",
        jpg: "JEAN PAUL GAULTIER",
      };

      function detectBrandIntent(rawTerm) {
        const lowerTerm = rawTerm.toLowerCase().trim();
        const tokens = lowerTerm.split(/\s+/);
        for (const [key, brandName] of Object.entries(BRAND_ALIASES)) {
          if (lowerTerm.includes(key)) return brandName;
        }
        for (const token of tokens) {
          if (BRAND_ALIASES[token]) return BRAND_ALIASES[token];
        }
        return null;
      }
      function normalizeAndTokenize(rawTerm) {
        return rawTerm
          .toLowerCase()
          .trim()
          .split(/\s+/)
          .filter((t) => t.length > 0);
      }
      function calculateRelevanceScore(product, searchTokens) {
        let score = 0;
        const pId = (product.id || "").toString().toLowerCase();
        const pName = (product.name || "").toLowerCase();
        const pBrand = (product.brand || "").toLowerCase();
        searchTokens.forEach((token) => {
          if (token.length < 1) return;
          if (pId.includes(token)) score += 100;
          if (pBrand.includes(token)) score += 60;
          if (pName.includes(token)) score += 50;
        });
        return score;
      }

      // --- Grid Render ---
      function switchToGrid(criteria) {
        viewMode = "grid";
        document.getElementById("home-view").style.display = "none";
        document.getElementById("grid-view").style.display = "block";
        window.scrollTo({ top: 0, behavior: "smooth" });

        const db = (window.perfumeDB || []).filter(
          (p) => parseInt(p.stock) > 0,
        );
        let filtered = [];
        let title = "";

        if (criteria === "All") {
          filtered = db;
          title = "All Products";
        } else if (criteria === "BestSellers") {
          filtered = db.filter((p) => p.top == 1);
          title = "Best Sellers";
        } else if (criteria === "New") {
          filtered = db.filter((p) => p.new == 1);
          title = "New Arrivals";
        } else if (criteria === "Sale") {
          filtered = db.filter((p) => p.sale == 1);
          title = "On Sale";
        } else if (criteria === "Set") {
          filtered = db.filter((p) => p.name.toUpperCase().includes("SET"));
          title = "Gift Sets Collection";
        } else if (criteria.startsWith("Gender:")) {
          const targetGender = criteria.split(":")[1];
          filtered = db.filter((p) => {
            if (!p.gender) return false;
            const gClass = getGenderClass(p.gender);
            return gClass === targetGender.toLowerCase();
          });
          title =
            targetGender === "Women"
              ? "For Her (Women)"
              : targetGender === "Men"
                ? "For Him (Men)"
                : "Unisex Collection";
        } else if (criteria.startsWith("Search:")) {
          const rawTerm = criteria.replace("Search:", "").trim();
          const targetBrand = detectBrandIntent(rawTerm);
          const searchTokens = normalizeAndTokenize(rawTerm);
          if (targetBrand) {
            let brandProducts = db.filter(
              (p) => p.brand.toLowerCase() === targetBrand.toLowerCase(),
            );
            let remainingTokens = searchTokens.filter(
              (t) =>
                !Object.keys(BRAND_ALIASES).some(
                  (k) =>
                    BRAND_ALIASES[k] === targetBrand &&
                    (k.includes(t) || t.includes(k)),
                ),
            );
            if (remainingTokens.length > 0) {
              let scored = brandProducts
                .map((p) => ({
                  product: p,
                  score: calculateRelevanceScore(p, remainingTokens),
                }))
                .filter((item) => item.score > 0);
              scored.sort((a, b) => b.score - a.score);
              filtered = scored.map((item) => item.product);
            } else {
              filtered = brandProducts;
            }
            title = `Brand Results: "${targetBrand}"`;
          } else {
            let scoredProducts = db
              .map((p) => ({
                product: p,
                score: calculateRelevanceScore(p, searchTokens),
              }))
              .filter((item) => item.score > 0);
            scoredProducts.sort((a, b) => b.score - a.score);
            filtered = scoredProducts.map((item) => item.product);
            title = `Results: "${rawTerm}"`;
          }
        } else if (criteria === "Other") {
          filtered = db.filter((p) => {
            const pBrandLower = p.brand ? p.brand.toLowerCase() : "";
            return pBrandLower && !FEATURED_BRANDS_LOWER.includes(pBrandLower);
          });
          title = "More Brands";
        } else {
          filtered = db.filter((p) => p.brand === criteria);
          title = criteria;
        }

        document.getElementById("grid-title").textContent = title;
        currentGridData = filtered;
        currentPage = 1;
        renderGridPage();
      }

      function renderGridPage() {
        const gallery = document.getElementById("gallery");
        gallery.innerHTML = "";
        const totalPages = Math.ceil(currentGridData.length / itemsPerPage);
        renderPagination(totalPages, currentPage);

        if (currentGridData.length === 0) {
          gallery.innerHTML =
            "<div style='grid-column:1/-1;text-align:center;padding:50px;color:#999;'>No items found.</div>";
          return;
        }
        const start = (currentPage - 1) * itemsPerPage;
        const pageItems = currentGridData.slice(start, start + itemsPerPage);

        pageItems.forEach((p) => {
          const div = document.createElement("div");
          div.className = "item";
          let badgesHtml = "";
          if (p.top == 1)
            badgesHtml += '<div class="badge-tag badge-hot">HOT</div>';
          if (p.new == 1)
            badgesHtml += '<div class="badge-tag badge-new">NEW</div>';
          if (p.sale == 1)
            badgesHtml += '<div class="badge-tag badge-sale">SALE</div>';
          const webpSrc = p.img.replace(/\.(jpg|png|jpeg)$/i, ".webp");
          const genderClass = getGenderClass(p.gender);
          const genderText = p.gender
            ? ` ¬∑ <span class="gender-tag ${genderClass}">${p.gender}</span>`
            : "";
          const stockHtml = getStockHtml(p.inventory);

          // Use NEW button logic
          const buttonHtml = getAddButtonHtml(p.id);

          div.innerHTML = `
              <div class="item-img-box skeleton-loader" onclick="openModalById('${p.id}')">
                  <picture><source srcset="${webpSrc}" type="image/webp"><img src="${p.img}" loading="lazy" class="lazy-img" onload="this.classList.add('loaded'); this.parentElement.parentElement.classList.remove('skeleton-loader');" onerror="this.parentElement.parentElement.classList.remove('skeleton-loader');"></picture>
                  <div class="badges-container">${badgesHtml}</div>
              </div>
              <div class="caption">
                 <div style="font-size:0.85rem; height:2.4em; overflow:hidden; margin-bottom:5px; line-height:1.2;">${p.id}-${p.name}</div>
                 <div style="font-size:0.8rem; color:#888; margin-bottom:5px;">${p.brand}${genderText} <br> ${formatSize(p)}</div>
                 <div class="item-price">$${p.price} ${stockHtml}</div>
                 <div class="btn-qty-wrapper" id="btn-wrap-grid-${p.id}">${buttonHtml}</div>
              </div>
           `;
          gallery.appendChild(div);
        });
      }

      function renderPagination(totalPages, activePage) {
        const container = document.getElementById("pagination-controls");
        if (!container) return;
        container.innerHTML = "";
        if (totalPages <= 1) {
          container.style.display = "none";
          return;
        }
        container.style.display = "flex";

        const createBtn = (
          text,
          page,
          isActive = false,
          isDisabled = false,
        ) => {
          const btn = document.createElement("button");
          btn.className = `page-btn ${isActive ? "active" : ""}`;
          btn.textContent = text;
          if (isDisabled) btn.disabled = true;
          else
            btn.onclick = () => {
              currentPage = page;
              renderGridPage();
              window.scrollTo({ top: 0, behavior: "smooth" });
            };
          return btn;
        };

        container.appendChild(
          createBtn("Prev", activePage - 1, false, activePage === 1),
        );
        const pages = [];
        if (totalPages <= 7) {
          for (let i = 1; i <= totalPages; i++) pages.push(i);
        } else {
          pages.push(1);
          if (activePage > 3) pages.push("...");
          let s = Math.max(2, activePage - 1),
            e = Math.min(totalPages - 1, activePage + 1);
          if (activePage === 1) e = 3;
          if (activePage === totalPages) s = totalPages - 2;
          for (let i = s; i <= e; i++) pages.push(i);
          if (activePage < totalPages - 2) pages.push("...");
          pages.push(totalPages);
        }
        pages.forEach((p) => {
          if (p === "...") {
            const span = document.createElement("span");
            span.textContent = "...";
            span.style.padding = "0 5px";
            span.style.color = "#999";
            container.appendChild(span);
          } else container.appendChild(createBtn(p, p, p === activePage));
        });
        container.appendChild(
          createBtn("Next", activePage + 1, false, activePage === totalPages),
        );
      }

      window.openModal = function (product) {
        currentModalProductId = product.id;
        document.getElementById("modal-img").src = product.img;
        document.getElementById("modal-title").textContent =
          `${product.id}-${product.name}`;
        const notesContent = product.Notes || product.notes;
        let notesHtml = "";
        if (notesContent && notesContent.trim() !== "") {
          notesHtml = `<div class="modal-notes-box"><span class="modal-notes-title">Fragrance Notes</span><span class="modal-notes-text">${notesContent}</span></div>`;
        }
        const genderClass = getGenderClass(product.gender);
        document.getElementById("modal-sub").innerHTML =
          `<div style="font-size:1.1rem; color:#333; margin-bottom:5px;">${product.brand}</div><div style="margin-bottom:8px; font-size:0.85rem; color:#555; display:flex; align-items:center; justify-content:center;"><span class="gender-tag ${genderClass}" style="font-size:0.8rem; margin:0 5px 0 0;">${product.gender || "Unisex"}</span><span style="color:#ccc">|</span> <span style="margin-left:5px">${formatSize(product)}</span></div>${notesHtml}`;

        const stockEl = document.getElementById("modal-stock");
        const stockVal = getStockHtml(product.inventory);
        if (stockVal) {
          stockEl.innerHTML = `<div style="color:#d9534f; font-weight:bold; font-size:0.95rem; border:1px solid #d9534f; display:inline-block; padding:3px 10px; border-radius:4px; background:#fff0f0;">üî• Fast Moving: Only ${product.inventory} Left!</div>`;
          stockEl.style.display = "block";
        } else {
          stockEl.style.display = "none";
        }

        document.getElementById("modal-price").textContent =
          "$" + product.price;
        updateModalButtonState(product.id);
        document.getElementById("modal").classList.add("open");
      };

      window.openModalById = function (id) {
        const p = window.perfumeDB.find((x) => x.id === id);
        if (p) openModal(p);
      };

      function setupSearch() {
        const globalSearch = document.getElementById("global-search-input");
        globalSearch.addEventListener("change", (e) => {
          const val = e.target.value.trim();
          if (val) switchToGrid("Search:" + val);
        });
      }

      window.handleMenuClick = function (action) {
        document.getElementById("sidebar").classList.remove("active");
        document.getElementById("sidebar-overlay").classList.remove("active");
        if (action === "Home") {
          viewMode = "home";
          document.getElementById("home-view").style.display = "block";
          document.getElementById("grid-view").style.display = "none";
          window.scrollTo({ top: 0 });
        } else switchToGrid(action);
      };

      window.scrollToBrand = function (brandName) {
        if (viewMode !== "home") {
          document.getElementById("home-view").style.display = "block";
          document.getElementById("grid-view").style.display = "none";
          viewMode = "home";
        }
        document.getElementById("sidebar").classList.remove("active");
        document.getElementById("sidebar-overlay").classList.remove("active");
        setTimeout(() => {
          const safeName =
            brandName === "Other" ? "Other" : brandName.replace(/\s+/g, "");
          const targetId = "brand-" + safeName;
          const element = document.getElementById(targetId);
          if (element) {
            const headerOffset = 65;
            const elementPosition = element.getBoundingClientRect().top;
            const offsetPosition =
              elementPosition + window.pageYOffset - headerOffset;
            window.scrollTo({ top: offsetPosition, behavior: "smooth" });
          } else switchToGrid(brandName === "Other" ? "Other" : brandName);
        }, 50);
      };

      function setupMenu() {
        const trigger = document.getElementById("menu-trigger");
        const overlay = document.getElementById("sidebar-overlay");
        const sidebar = document.getElementById("sidebar");
        function toggle() {
          sidebar.classList.toggle("active");
          overlay.classList.toggle("active");
        }
        trigger.onclick = toggle;
        overlay.onclick = toggle;
      }
      function showToast(msg) {
        const t = document.getElementById("toast");
        t.textContent = msg;
        t.classList.add("show");
        setTimeout(() => t.classList.remove("show"), 2000);
      }

      window.updateItemQty = function (id, delta) {
        const db = window.perfumeDB;
        const product = db.find((p) => p.id === id);
        if (!product) return;

        let existing = cartItems.find((c) => c.name === id);
        if (!existing && delta > 0) {
          let sizeLabel = product.ml
            ? isNaN(Number(product.ml))
              ? `(${product.ml})`
              : `(${product.ml}ml)`
            : "";
          cartItems.push({
            name: id,
            caption: `${id} - ${product.name} ${sizeLabel}`,
            img: product.img,
            price: Number(product.price),
            brand: product.brand,
            ml: product.ml,
            quantity: 1,
          });
          showToast("Added to Cart! üõí");
        } else if (existing) {
          existing.quantity += delta;
          if (existing.quantity <= 0)
            cartItems = cartItems.filter((c) => c.name !== id);
        }
        saveCart();
        updateWholesaleBanner();
        // Update both the LIST VIEW style button and Modal style button if they exist
        const newBtnHtml = getAddButtonHtml(id);
        const scrollBtnWrap = document.getElementById(`btn-wrap-${id}`);
        if (scrollBtnWrap) scrollBtnWrap.innerHTML = newBtnHtml;
        const gridBtnWrap = document.getElementById(`btn-wrap-grid-${id}`);
        if (gridBtnWrap) gridBtnWrap.innerHTML = newBtnHtml;

        // Also update modal state if open
        if (currentModalProductId === id) updateModalButtonState(id);
      };

      // Separate function for modal button state to ensure it keeps its own styling structure if needed
      // (Though here we are using the same HTML structure for both, just in case you want to tweak one later)
      function updateModalButtonState(id) {
        const container = document.getElementById("modal-action-area");
        // Reuse the logic, but we could also write specific HTML if the modal needed to look different
        container.innerHTML = getAddButtonHtml(id);
      }

      window.checkoutViaWhatsapp = function () {
        if (cartItems.length === 0) return showToast("Cart is empty");
        let totalQty = 0,
          lvCount = 0,
          otherCount = 0,
          subtotal = 0;
        cartItems.forEach((item) => {
          const qty = item.quantity;
          totalQty += qty;
          subtotal += item.price * qty;
          if (item.caption.toLowerCase().includes("louis vuitton"))
            lvCount += qty;
          else otherCount += qty;
        });
        const tier = discountTiers.find(
          (t) => totalQty >= t.min && totalQty <= t.max,
        );
        const discountAmount = subtotal * (tier ? tier.percent : 0);
        const finalTotal = subtotal - discountAmount;
        let msg = `*New Order Request* üì¶\n----------------------------\n`;
        cartItems.forEach((item) => {
          msg += `${item.caption} x *${item.quantity}*\n\n`;
        });
        msg += `----------------------------\nLV Quantity: ${lvCount}\nOther Quantity: ${otherCount}\n*Total Quantity: ${totalQty} pcs*\n----------------------------\n*Total Amount:* $${Math.round(finalTotal).toFixed(2)}`;
        window.open(
          `https://wa.me/16232027321?text=${encodeURIComponent(msg)}`,
          "_blank",
        );
      };

      function loadCart() {
        cartItems = JSON.parse(localStorage.getItem("perfumeCart") || "[]");
        updateCartCount();
        updateWholesaleBanner();
      }
      function saveCart() {
        localStorage.setItem("perfumeCart", JSON.stringify(cartItems));
        updateCartCount();
      }
      function updateCartCount() {
        const el = document.getElementById("header-cart-count");
        if (el) el.textContent = cartItems.reduce((s, i) => s + i.quantity, 0);
      }
      function setupModalBackdropClosing() {
        document.querySelectorAll(".modal").forEach((o) =>
          o.addEventListener("click", (e) => {
            if (e.target === o) {
              o.classList.remove("open");
              currentModalProductId = null;
            }
          }),
        );
      }
    </script>
  </body>
</html>
