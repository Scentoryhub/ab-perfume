<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Perfume List</title>
    <link rel="icon" type="image/png" href="icon/32.png" />
    <link rel="apple-touch-icon" href="icon/180.png" />

    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-ZKERETN8Y2"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      // ÈÖçÁΩÆÂπ∂ÊèêÂèñ Client ID Áî®‰∫é WhatsApp Âõû‰º†
      gtag("config", "G-ZKERETN8Y2", {
        custom_map: { dimension1: "client_id" },
      });

      gtag("get", "G-ZKERETN8Y2", "client_id", (clientID) => {
        localStorage.setItem("ga_client_id", clientID);
        gtag("set", "user_properties", { client_id: clientID });
      });
    </script>

    <script>
      !(function (f, b, e, v, n, t, s) {
        if (f.fbq) return;
        n = f.fbq = function () {
          n.callMethod
            ? n.callMethod.apply(n, arguments)
            : n.queue.push(arguments);
        };
        if (!f._fbq) f._fbq = n;
        n.push = n;
        n.loaded = !0;
        n.version = "2.0";
        n.queue = [];
        t = b.createElement(e);
        t.async = !0;
        t.src = v;
        s = b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t, s);
      })(
        window,
        document,
        "script",
        "https://connect.facebook.net/en_US/fbevents.js"
      );
      fbq("init", "9083739771684521");
      fbq("track", "PageView");
    </script>
    <noscript
      ><img
        height="1"
        width="1"
        style="display: none"
        src="https://www.facebook.com/tr?id=9083739771684521&ev=PageView&noscript=1"
    /></noscript>
    <style>
      /* =========================================
         GLOBAL STYLES
         ========================================= */
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        padding: 0;
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        background: #fff;
        color: #222;
        -webkit-font-smoothing: antialiased;
      }
      a {
        color: black;
        font-weight: bold;
        text-decoration: none;
      }

      /* =========================================
         HEADER & SEARCH
         ========================================= */
      .price-info {
        max-width: 600px;
        margin: 0 auto 20px auto;
        padding: 20px;
        background-color: #f9f9f9;
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        text-align: center;
      }
      .price-info p {
        margin: 8px 0;
        font-size: 1rem;
        color: #333;
        font-weight: 500;
      }
      .TOP {
        text-align: center;
        margin-top: 20px;
      }
      .info-button {
        background: none;
        border: none;
        color: #333;
        font-weight: 700;
        text-decoration: underline;
        cursor: pointer;
        font-size: 1rem;
        padding: 5px;
      }

      .search-container {
        max-width: 600px;
        margin: 20px auto;
        padding: 0 15px;
        position: relative;
      }
      #search-input {
        width: 100%;
        padding: 12px 40px 12px 20px;
        font-size: 1.1rem;
        border: 1px solid #ccc;
        border-radius: 25px;
        outline: none;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }
      #search-clear-btn {
        position: absolute;
        top: 50%;
        right: 30px;
        transform: translateY(-50%);
        background: #ccc;
        color: white;
        border: none;
        border-radius: 50%;
        width: 22px;
        height: 22px;
        cursor: pointer;
        display: none;
        align-items: center;
        justify-content: center;
      }
      .sort-container {
        max-width: 900px;
        margin: 0 auto 15px auto;
        padding: 0 20px;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .sort-container label {
        margin-right: 10px;
        font-weight: 600;
        color: #555;
      }
      #sort-by {
        padding: 8px 12px;
        font-size: 1rem;
        border: 1px solid #ccc;
        border-radius: 8px;
        background-color: #f9f9f9;
      }

      /* =========================================
         BRAND NAVBAR
         ========================================= */
      .navbar {
        display: flex;
        justify-content: flex-start;
        overflow-x: auto;
        gap: 10px;
        position: sticky;
        top: 0;
        z-index: 100;
        padding: 12px 15px;
        background: rgba(255, 255, 255, 0.95);
        border-bottom: 1px solid #eee;
        backdrop-filter: blur(10px);
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
      }
      .navbar::-webkit-scrollbar {
        display: none;
      }
      .navbar button {
        flex: 0 0 auto;
        background: #f8f8f8;
        border: 1px solid #e0e0e0;
        padding: 8px 18px;
        cursor: pointer;
        font-size: 0.95rem;
        font-weight: 500;
        border-radius: 25px;
        color: #555;
        transition: all 0.2s ease;
      }
      .navbar button.active {
        background: #222;
        color: #fff;
        border-color: #222;
      }

      /* =========================================
         TOP PICKS & GALLERY
         ========================================= */
      #top-picks-container {
        display: none;
        max-width: 1200px;
        margin: 0 auto;
      }
      .top-scroll-wrapper {
        display: flex;
        overflow-x: auto;
        gap: 15px;
        padding: 10px 15px;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
      }
      .top-scroll-wrapper::-webkit-scrollbar {
        display: none;
      }
      .top-card {
        flex: 0 0 140px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        overflow: hidden;
        position: relative;
        border: 1px solid #f0f0f0;
        cursor: pointer;
      }
      .top-card img {
        width: 100%;
        height: 140px;
        object-fit: cover;
      }
      .top-card .top-info {
        padding: 10px;
        text-align: center;
      }
      .top-card .top-name {
        font-size: 0.85rem;
        font-weight: bold;
        margin-bottom: 5px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .top-card .top-price {
        color: #d9534f;
        font-weight: 800;
        font-size: 0.95rem;
      }
      .hot-badge {
        position: absolute;
        top: 8px;
        left: 8px;
        background: linear-gradient(135deg, #ff6b6b, #ff3b30);
        color: white;
        font-size: 0.7rem;
        padding: 3px 8px;
        border-radius: 6px;
        font-weight: 800;
      }

      .gallery {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 10px;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        min-height: 300px;
      }
      .item {
        position: relative;
        overflow: hidden;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        background: #fff;
        transition: transform 0.3s ease;
      }
      .item[data-stock="0"] {
        display: none;
      }
      .item img {
        width: 100%;
        height: 250px;
        object-fit: cover;
      }
      .caption {
        padding: 16px;
        font-size: 1rem;
        font-weight: 600;
        text-align: center;
        border-top: 1px solid #eee;
      }
      .product-size {
        font-size: 0.85rem;
        color: #888;
        margin: 4px 0;
        font-weight: normal;
      }
      .item .add-to-cart {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: #fff;
        border: none;
        border-radius: 50%;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 1.2rem;
        z-index: 3;
      }
      .item-cart-count {
        position: absolute;
        top: -5px;
        right: -5px;
        background-color: #f44;
        color: white;
        border-radius: 50%;
        padding: 2px 6px;
        font-size: 0.8rem;
        display: none;
      }
      .add-to-cart-confirmation {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #28a745;
        color: white;
        padding: 6px 12px;
        border-radius: 15px;
        font-size: 0.9rem;
        font-weight: bold;
        opacity: 0;
        transition: all 0.5s ease;
        z-index: 10;
        pointer-events: none;
      }
      .add-to-cart-confirmation.show {
        opacity: 1;
        transform: translate(-50%, -100%);
      }

      /* === WHY BUY FROM US SECTION === */
      .trust-section {
        max-width: 1200px;
        margin: 40px auto;
        padding: 30px 20px;
        background: #fdfdfd;
        border-top: 1px solid #eee;
      }
      .trust-title {
        text-align: center;
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 30px;
        color: #222;
      }
      .trust-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 30px;
      }
      .trust-item {
        text-align: center;
        padding: 20px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      }
      .trust-icon {
        font-size: 2.5rem;
        margin-bottom: 15px;
        display: block;
      }
      .trust-img-container {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 15px;
        overflow-x: auto;
      }
      .trust-review-img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 8px;
        border: 1px solid #eee;
      }
      .trust-text h4 {
        margin: 10px 0;
        font-size: 1.1rem;
      }
      .trust-text p {
        font-size: 0.95rem;
        color: #666;
        line-height: 1.5;
      }

      /* =========================================
         MODALS & BUTTONS
         ========================================= */
      .modal {
        display: none;
        position: fixed;
        z-index: 9999;
        left: 0;
        top: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.85);
        justify-content: center;
        align-items: center;
        padding: 15px;
      }
      .modal.open {
        display: flex;
      }
      .modal-content {
        max-width: 600px;
        width: 90vw;
        max-height: 90vh;
        border-radius: 12px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        background: #fff;
        text-align: center;
        position: relative;
      }
      .modal-content img {
        width: 100%;
        max-height: 60vh;
        object-fit: contain;
        background: #f9f9f9;
      }
      .modal-close {
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 2rem;
        color: #fff;
        cursor: pointer;
        transition: transform 0.3s ease;
      }
      .modal-controls {
        padding: 20px;
        display: flex;
        justify-content: center;
      }
      .modal-add-btn {
        background-color: #333;
        color: white;
        border: none;
        padding: 12px 24px;
        font-size: 1rem;
        border-radius: 25px;
        cursor: pointer;
      }
      .modal-qty-controls {
        display: flex;
        align-items: center;
        gap: 15px;
      }
      .modal-qty-btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        font-size: 1.5rem;
        cursor: pointer;
        background: #f0f0f0;
        border: 1px solid #ccc;
      }

      .cart-button {
        position: fixed;
        bottom: 30px;
        right: 20px;
        background-color: #ffffff;
        color: white;
        border: none;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        cursor: pointer;
      }
      .cart-button.added {
        animation: cart-pulse 0.6s ease-out;
      }
      @keyframes cart-pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.15);
        }
        100% {
          transform: scale(1);
        }
      }
      .cart-count {
        position: absolute;
        top: -5px;
        right: -5px;
        background-color: #f44;
        color: white;
        border-radius: 50%;
        padding: 2px 6px;
        font-size: 0.8rem;
      }
      .cart-icon {
        width: 32px;
        height: 32px;
      }

      .back-to-top {
        display: none;
        position: fixed;
        bottom: 30px;
        left: 30px;
        background-color: #333;
        color: white;
        border: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        text-align: center;
        line-height: 50px;
        cursor: pointer;
        font-size: 1.5rem;
        z-index: 1000;
      }
      /* === ÁßªÂä®Á´Ø Bug ‰øÆÂ§çË°•‰∏Å === */

      /* 1. Âº∫Âà∂ÊèêÂçáÂºπÁ™óÂ±ÇÁ∫ßÔºåÁ°Æ‰øùÂÆÉÁõñ‰ΩèÊâÄÊúâÊåâÈíÆ */
      .modal {
        z-index: 2147483647 !important; /* ËøôÊòØ‰∏Ä‰∏™Â∑®Â§ßÁöÑÊï∞Â≠óÔºå‰øùËØÅÂú®ÊúÄÈ°∂Â±Ç */
        background-color: rgba(0, 0, 0, 0.85) !important; /* Âº∫Âà∂ËÉåÊôØÂèòÊöó */
      }

      /* 2. ÂºπÁ™óÊâìÂºÄÊó∂ÔºåÈöêËóè‚ÄúÂõûÂà∞È°∂ÈÉ®‚ÄùÂíå‚ÄúË¥≠Áâ©ËΩ¶‚ÄùÊÇ¨ÊµÆÊåâÈíÆÔºåÈò≤Ê≠¢Á©øÈÄè */
      body.modal-open .back-to-top,
      body.modal-open .cart-button {
        display: none !important;
      }

      /* 3. ÂºπÁ™óÊâìÂºÄÊó∂ÔºåÁ¶ÅÊ≠¢ËÉåÊôØÈ°µÈù¢ÊªöÂä® */
      body.modal-open {
        overflow: hidden !important;
      }

      /* 4. ‰ºòÂåñÁßªÂä®Á´ØÂºπÁ™óÂÜÖÂõæÁâáÂ§ßÂ∞èÔºåÈò≤Ê≠¢ÊääÊåâÈíÆÊå§Âá∫Â±èÂπï */
      @media (max-width: 767px) {
        .modal-content img {
          max-height: 35vh !important; /* ÈôêÂà∂ÂõæÁâáÈ´òÂ∫¶ */
          margin-bottom: 10px;
        }
        .modal-caption {
          font-size: 1rem !important; /* Ë∞ÉÊï¥Â≠ó‰ΩìÂ§ßÂ∞è */
          padding: 5px 15px !important;
        }
      }

      /* Responsive */
      @media (min-width: 768px) {
        .gallery {
          grid-template-columns: repeat(4, 1fr);
          gap: 40px;
          padding: 0 20px;
        }
        .top-scroll-wrapper {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
          overflow-x: visible;
          gap: 25px;
          padding: 20px;
        }
        .top-card {
          width: auto;
        }
        .top-card img {
          height: 200px;
        }
        .trust-grid {
          grid-template-columns: repeat(3, 1fr);
        }
      }
      @media (max-width: 767px) {
        .modal {
          align-items: flex-end;
          padding: 0;
        }
        .modal-content {
          width: 100%;
          border-radius: 20px 20px 0 0;
          padding-bottom: 30px;
        }
        .modal-close {
          color: #333;
          background: rgba(255, 255, 255, 0.8);
          width: 30px;
          height: 30px;
          line-height: 30px;
          border-radius: 50%;
          top: 10px;
          right: 15px;
        }
      }
    </style>
  </head>
  <body>
    <h2 class="TOP">Perfume List</h2>

    <div class="price-info">
      <div>
        <p style="font-size: 1.1rem; font-weight: 700">Perfumes: From $30</p>
        <p style="font-size: 1.1rem; font-weight: 600">
          Free Shipping | Buy more save more !
        </p>
        <p style="font-size: 1.1rem; font-weight: 700">USA WAREHOUSE</p>
        <p style="font-size: 0.9rem; color: #555">
          (Exact price is shown on each product)
        </p>
      </div>
      <hr class="info-divider" />
      <div style="margin-top: 15px">
        <button id="policy-btn" class="info-button" style="color: #f44">
          Compensation Policy
        </button>
      </div>
    </div>

    <div class="search-container">
      <input
        type="search"
        id="search-input"
        placeholder="Search by name, brand or number..."
      />
      <button id="search-clear-btn" title="Clear search">&times;</button>
    </div>

    <div class="sort-container">
      <label for="sort-by">Sort By:</label>
      <select id="sort-by">
        <option value="default">Default (A-Z)</option>
        <option value="newest">Newest First</option>
        <option value="price-asc">Price: Low to High</option>
        <option value="price-desc">Price: High to Low</option>
      </select>
    </div>

    <div class="navbar" id="brand-navbar">
      <button data-brand="All" class="active">All Brands</button>
      <button data-brand="Giorgio Armani">Armani</button>
      <button data-brand="Azzaro">Azzaro</button>
      <button data-brand="Burberry">Burberry</button>
      <button data-brand="BVLGARI">BVLGARI</button>
      <button data-brand="Carolina Herrera">Carolina Herrera</button>
      <button data-brand="Chanel">Chanel</button>
      <button data-brand="Creed">Creed</button>
      <button data-brand="Dior">Dior</button>
      <button data-brand="Givenchy">Givenchy</button>
      <button data-brand="Gucci">Gucci</button>
      <button data-brand="Initio">Initio</button>
      <button data-brand="Jean Paul Gaultier">Jean Paul Gaultier</button>
      <button data-brand="Kayali">Kayali</button>
      <button data-brand="Kilian">Kilian</button>
      <button data-brand="Lanc√¥me">Lanc√¥me</button>
      <button data-brand="Lattafa">Lattafa</button>
      <button data-brand="Louis Vuitton">Louis Vuitton</button>
      <button data-brand="Maison Francis Kurkdjian">
        Maison Francis Kurkdjian
      </button>
      <button data-brand="Paco Rabanne">Paco Rabanne</button>
      <button data-brand="Parfums de Marly">Parfums de Marly</button>
      <button data-brand="Prada">Prada</button>
      <button data-brand="Ralph Lauren">Ralph Lauren</button>
      <button data-brand="Tom Ford">Tom Ford</button>
      <button data-brand="Valentino">Valentino</button>
      <button data-brand="Versace">Versace</button>
      <button data-brand="Xerjoff">Xerjoff</button>
      <button data-brand="Yves Saint Laurent">Yves Saint Laurent</button>
      <button data-brand="Other">Other Brands</button>
    </div>

    <div id="top-picks-container">
      <h3 style="padding: 0 15px; margin-bottom: 10px; font-size: 1.1rem">
        üî• Best Sellers
      </h3>
      <div class="top-scroll-wrapper" id="top-gallery"></div>
      <hr style="margin: 20px 15px; border: 0; border-top: 1px solid #eee" />
    </div>

    <div class="gallery" id="gallery">
      <div class="gallery-loader"></div>
    </div>

    <div class="trust-section">
      <h2 class="trust-title">Why Buy From Us?</h2>
      <div class="trust-grid">
        <div class="trust-item">
          <span class="trust-icon">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
          <div class="trust-text">
            <h4>Happy Customers</h4>
            <p>
              Join thousands of satisfied customers. Check out our real reviews!
            </p>
          </div>
          <div class="trust-img-container">
            <img
              src="images/review1.jpg"
              alt="Review"
              class="trust-review-img"
              onerror="this.style.display='none'"
            />
            <img
              src="images/review2.jpg"
              alt="Review"
              class="trust-review-img"
              onerror="this.style.display='none'"
            />
            <img
              src="images/review3.jpg"
              alt="Review"
              class="trust-review-img"
              onerror="this.style.display='none'"
            />
            <img
              src="images/review4.jpg"
              alt="Review"
              class="trust-review-img"
              onerror="this.style.display='none'"
            />
            <img
              src="images/review5.jpg"
              alt="Review"
              class="trust-review-img"
              onerror="this.style.display='none'"
            />
          </div>
        </div>
        <div class="trust-item">
          <span class="trust-icon">üõ°Ô∏è</span>
          <div class="trust-text">
            <h4>Broken? We Reship!</h4>
            <p>
              Don't worry about shipping damage. If it arrives broken or leaked,
              show us a photo and we will reship for <strong>FREE</strong>.
            </p>
            <button
              onclick="document.getElementById('policy-modal').classList.add('open')"
              style="
                margin-top: 10px;
                background: none;
                border: none;
                text-decoration: underline;
                cursor: pointer;
                color: #007bff;
              "
            >
              See Policy
            </button>
          </div>
        </div>
        <div class="trust-item">
          <span class="trust-icon">üí¨</span>
          <div class="trust-text">
            <h4>24/7 WhatsApp Support</h4>
            <p>
              We are always online. Get instant quotes, track your order, and
              get expert recommendations anytime.
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="modal">
      <div class="modal-close" id="modal-close">&times;</div>
      <div class="modal-content">
        <img src="" alt="" id="modal-img" />
        <div class="modal-caption" id="modal-caption"></div>
        <div class="modal-controls">
          <button class="modal-add-btn">Add to Cart</button>
          <div class="modal-qty-controls">
            <button class="modal-qty-btn" data-action="decrease">-</button>
            <span class="modal-qty-count">1</span>
            <button class="modal-qty-btn" data-action="increase">+</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="policy-modal">
      <div class="modal-close" id="policy-modal-close">&times;</div>
      <div
        class="modal-content"
        style="max-width: 500px; text-align: left; padding: 25px"
      >
        <h3 style="text-align: center; margin-top: 0; font-size: 1.4rem">
          Compensation Policy
        </h3>
        <p>
          Please check your items upon delivery. If you have any issues, follow
          these steps for a free reshipment:
        </p>
        <ul style="padding-left: 20px">
          <li>
            <strong>1. Leaked or Damaged:</strong> Provide photos of: Outer
            Packaging + Shipping Label + Damaged Goods.
          </li>
          <li>
            <strong>2. Wrong Product Sent:</strong> Provide photos of: Shipping
            Label + Incorrect Goods.
          </li>
        </ul>
        <p
          style="
            font-weight: bold;
            text-align: center;
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 8px;
          "
        >
          Important: Please keep all shipping packaging until you've checked
          everything.
        </p>
      </div>
    </div>

    <div class="modal" id="receipt-modal">
      <div class="modal-close" id="receipt-modal-close">&times;</div>
      <div
        class="modal-content"
        style="max-width: 600px; padding: 0; overflow: hidden"
      >
        <img
          src="images/receipt.webp"
          alt="Receipt Example"
          style="max-height: 85vh"
        />
        <div style="padding: 12px; font-weight: bold">Example Receipt</div>
      </div>
    </div>

    <footer>
      <div class="contact-info">
        <a href="https://wa.me/16232027321"
          >Need help? Contact us on WhatsApp</a
        >
        <p>We are available 24/7</p>
      </div>
    </footer>

    <button id="back-to-top" class="back-to-top">&#x25B2;</button>

    <button class="cart-button" id="cart-button">
      <img src="icon/order.png" alt="Cart" class="cart-icon" />
      <span id="cart-count" class="cart-count">0</span>
    </button>

    <script src="db.js"></script>
    <script>
      // =================================================================
      // CORE LOGIC & TRACKING
      // =================================================================

      let cartItems = [];
      let gallery,
        searchInput,
        searchClearBtn,
        cartButton,
        cartCount,
        brandNavbar;

      function loadCartFromLocalStorage() {
        const storedCart = localStorage.getItem("perfumeCart");
        cartItems = storedCart ? JSON.parse(storedCart) : [];
      }
      function saveCartToLocalStorage() {
        localStorage.setItem("perfumeCart", JSON.stringify(cartItems));
      }
      function updateCartCount() {
        const count = cartItems.reduce(
          (total, item) => total + item.quantity,
          0
        );
        if (cartCount) cartCount.textContent = count;
      }
      function renderItemCounts() {
        if (!gallery) return;
        const currentItems = gallery.querySelectorAll(".item");
        currentItems.forEach((item) => {
          const itemName = item.dataset.name;
          const badge = item.querySelector(".item-cart-count");
          const itemInCart = cartItems.find((c) => c.name === itemName);
          if (itemInCart && itemInCart.quantity > 0) {
            badge.textContent = itemInCart.quantity;
            badge.style.display = "block";
          } else {
            badge.style.display = "none";
          }
        });
      }
      function pulseCartButton() {
        cartButton.classList.add("added");
        setTimeout(() => cartButton.classList.remove("added"), 600);
      }
      function showConfirmation(button) {
        const confirmation = document.createElement("div");
        confirmation.textContent = "Added!";
        confirmation.className = "add-to-cart-confirmation";
        const itemElement = button.closest(".item");
        itemElement.appendChild(confirmation);
        setTimeout(() => confirmation.classList.add("show"), 10);
        setTimeout(() => confirmation.remove(), 1500);
      }

      // --- ADD TO CART FUNCTION (With Tracking) ---
      function addItemToCart(productId) {
        const db = window.perfumeDB || [];
        const perfumeData = db.find((p) => p.id === productId);
        if (!perfumeData) return;

        // 1. Logic
        const existingItem = cartItems.find((c) => c.name === productId);
        if (existingItem) {
          existingItem.quantity++;
        } else {
          cartItems.push({
            name: productId,
            caption: `${productId} - ${perfumeData.name}`,
            img: perfumeData.img,
            quantity: 1,
            price: Number(perfumeData.price),
            tier: perfumeData.tier,
            ml: perfumeData.ml,
            floz: perfumeData.floz,
          });
        }
        saveCartToLocalStorage();
        updateCartCount();
        renderItemCounts();
        pulseCartButton();

        // 2. TRACKING (Pixel + GA4)
        if (typeof fbq !== "undefined") {
          fbq("track", "AddToCart", {
            content_ids: [productId],
            content_type: "product",
            value: perfumeData.price,
            currency: "USD",
          });
        }
        if (typeof gtag !== "undefined") {
          gtag("event", "add_to_cart", {
            currency: "USD",
            value: perfumeData.price,
            items: [{ item_id: productId, item_name: perfumeData.name }],
          });
        }
      }

      // --- Render & Filter Logic ---
      window.renderPerfumes = function () {
        const db = window.perfumeDB || [];
        if (!gallery) return;

        // Render Top Picks
        const topContainer = document.getElementById("top-picks-container");
        const topGallery = document.getElementById("top-gallery");
        const topItems = db.filter((p) => p.top == 1);
        if (topContainer && topGallery && topItems.length > 0) {
          topGallery.innerHTML = "";
          topItems.forEach((p) => {
            const el = document.createElement("div");
            el.className = "top-card";
            el.onclick = () => {
              const mainItem = document.querySelector(
                `.item[data-name="${p.id}"]`
              );
              if (mainItem) mainItem.click();
            };
            el.innerHTML = `
                   <div class="hot-badge">HOT</div>
                   <img src="${p.img}" loading="lazy">
                   <div class="top-info"><div class="top-name">${p.name}</div><div class="top-price">$${p.price}</div></div>`;
            topGallery.appendChild(el);
          });
        }
        window.applyLastState();
      };

      window.filterAndSearch = function () {
        const db = window.perfumeDB || [];
        if (db.length === 0) return;
        const activeBrandBtn = brandNavbar.querySelector("button.active");
        const selectedBrand = activeBrandBtn
          ? activeBrandBtn.dataset.brand
          : "All";
        const selectedSort = document.getElementById("sort-by").value;
        const term = searchInput.value.toLowerCase().trim();

        // Top Picks Visibility
        const topContainer = document.getElementById("top-picks-container");
        if (topContainer) {
          const hasTop = db.some((p) => p.top == 1);
          topContainer.style.display =
            selectedBrand === "All" && !term && hasTop ? "block" : "none";
        }

        let filtered = db.filter((p) => {
          let brandMatch =
            selectedBrand === "All"
              ? true
              : selectedBrand === "Other"
              ? ![
                  "Dior",
                  "Chanel",
                  "Gucci",
                  "Tom Ford",
                  "Versace",
                  "YSL",
                  "Creed",
                  "Armani",
                  "Prada",
                  "Valentino",
                ].includes(p.brand)
              : p.brand === selectedBrand;
          if (selectedBrand === "Other") {
            const majors = [
              "Dior",
              "Chanel",
              "Gucci",
              "Tom Ford",
              "Versace",
              "YSL",
              "Creed",
              "Armani",
              "Prada",
              "Valentino",
            ];
            brandMatch = !majors.some((b) => p.brand.includes(b));
          }
          let searchMatch = true;
          if (term)
            searchMatch =
              p.name.toLowerCase().includes(term) ||
              p.id.toLowerCase().includes(term) ||
              p.brand.toLowerCase().includes(term);
          return brandMatch && searchMatch;
        });

        // Sort
        if (selectedSort === "price-asc")
          filtered.sort((a, b) => a.price - b.price);
        else if (selectedSort === "price-desc")
          filtered.sort((a, b) => b.price - a.price);
        else if (selectedSort === "newest") filtered.reverse();
        else
          filtered.sort((a, b) =>
            a.id.localeCompare(b.id, undefined, {
              numeric: true,
              sensitivity: "base",
            })
          );

        // Render
        gallery.innerHTML = "";
        if (filtered.length === 0) {
          gallery.innerHTML =
            '<div class="no-results-message">No items found.</div>';
          return;
        }
        filtered.forEach((p) => {
          const item = document.createElement("div");
          item.className = "item";
          item.dataset.name = p.id;
          item.dataset.img = p.img;
          item.innerHTML = `
                <img src="${p.img}" loading="lazy">
                <div class="caption">${p.id} - ${p.name}<br><span class="product-size">${p.ml}ml</span><br><strong>$${p.price}</strong></div>
                <button class="add-to-cart">üõí <span class="item-cart-count"></span></button>`;
          gallery.appendChild(item);
        });
        renderItemCounts();

        localStorage.setItem("lastFilterBrand", selectedBrand);
        localStorage.setItem("lastSearchTerm", term);
        localStorage.setItem("lastSort", selectedSort);
      };

      window.applyLastState = function () {
        const lastBrand = localStorage.getItem("lastFilterBrand") || "All";
        const lastSearch = localStorage.getItem("lastSearchTerm") || "";
        const lastSort = localStorage.getItem("lastSort") || "default";

        document.getElementById("sort-by").value = lastSort;
        searchInput.value = lastSearch;

        const btns = document.querySelectorAll(".navbar button");
        btns.forEach((b) => {
          if (b.dataset.brand === lastBrand) b.classList.add("active");
          else b.classList.remove("active");
        });

        if (lastSearch)
          document.getElementById("search-clear-btn").style.display = "flex";
        window.filterAndSearch();
      };

      // --- Init ---
      document.addEventListener("DOMContentLoaded", () => {
        gallery = document.getElementById("gallery");
        searchInput = document.getElementById("search-input");
        searchClearBtn = document.getElementById("search-clear-btn");
        cartButton = document.getElementById("cart-button");
        cartCount = document.getElementById("cart-count");
        brandNavbar = document.getElementById("brand-navbar");

        brandNavbar.addEventListener("click", (e) => {
          if (e.target.tagName === "BUTTON") {
            brandNavbar
              .querySelectorAll("button")
              .forEach((b) => b.classList.remove("active"));
            e.target.classList.add("active");
            searchInput.value = "";
            searchClearBtn.style.display = "none";
            window.filterAndSearch();
          }
        });

        searchInput.addEventListener("input", () => {
          searchClearBtn.style.display = searchInput.value ? "flex" : "none";
          window.filterAndSearch();
        });
        searchClearBtn.addEventListener("click", () => {
          searchInput.value = "";
          searchInput.dispatchEvent(new Event("input"));
        });
        document
          .getElementById("sort-by")
          .addEventListener("change", window.filterAndSearch);

        cartButton.addEventListener(
          "click",
          () => (window.location.href = "cart.html")
        );

        gallery.addEventListener("click", (e) => {
          const addBtn = e.target.closest(".add-to-cart");
          if (addBtn) {
            e.stopPropagation();
            const item = addBtn.closest(".item");
            addItemToCart(item.dataset.name);
            showConfirmation(addBtn);
          } else {
            const item = e.target.closest(".item");
            if (item) {
              const modal = document.getElementById("modal");
              const img = document.getElementById("modal-img");
              const cap = document.getElementById("modal-caption");
              const addBtnModal = document.querySelector(".modal-add-btn");

              img.src = item.dataset.img;
              cap.innerHTML = item.querySelector(".caption").innerHTML;

              addBtnModal.onclick = () => {
                addItemToCart(item.dataset.name);
                modal.classList.remove("open");
              };
              modal.classList.add("open");
            }
          }
        });

        document.getElementById("modal-close").onclick = () =>
          document.getElementById("modal").classList.remove("open");
        document.getElementById("policy-modal-close").onclick = () =>
          document.getElementById("policy-modal").classList.remove("open");
        document.getElementById("receipt-modal-close").onclick = () =>
          document.getElementById("receipt-modal").classList.remove("open");

        const backToTop = document.getElementById("back-to-top");
        window.addEventListener("scroll", () => {
          backToTop.style.display = window.pageYOffset > 300 ? "block" : "none";
        });
        backToTop.onclick = () =>
          window.scrollTo({ top: 0, behavior: "smooth" });

        loadCartFromLocalStorage();
        updateCartCount();

        // ‚úÖ‚úÖ‚úÖ ËøôÈáåÂ∞±ÊòØÁº∫Â§±ÁöÑÂÖ≥ÈîÆ‰ª£Á†ÅÔºöÂêØÂä®Ê∏≤ÊüìÂºïÊìéÔºÅ ‚úÖ‚úÖ‚úÖ
        window.renderPerfumes();
      });
    </script>
  </body>
</html>
